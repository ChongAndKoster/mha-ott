<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="mobile-web-app-capable" content="yes">

      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
      <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>

      <!-- <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script> -->
      <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.min.js" integrity="sha384-IDwe1+LCz02ROU9k972gdyvl+AESN10+x7tBKgc9I5HFtuNz0wWnPclzo6p9vxnk" crossorigin="anonymous"></script> -->

  

	  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css">
	  <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>
  

	<script src="https://cdnjs.cloudflare.com/ajax/libs/iframe-resizer/4.3.2/iframeResizer.contentWindow.min.js" integrity="sha512-14SY6teTzhrLWeL55Q4uCyxr6GQOxF3pEoMxo2mBxXwPRikdMtzKMYWy2B5Lqjr6PHHoGOxZgPaxUYKQrSmu0A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.5/purify.min.js" integrity="sha512-KqUc2WMPF/gxte9xVjVE4TIt1LMUTidO3BrcItFg0Ro24I7pGNzgcXdnWdezNY+8T0/JEmdC79MuwYn+8UdOqw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js" integrity="sha512-CryKbMe7sjSCDPl18jtJI5DR5jtkUWxPXWaLCst6QjH8wxDexfRJic2WRmRXmstr2Y8SxDDWuBO6CQC6IE4KTA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js" integrity="sha512-42PE0rd+wZ2hNXftlM78BSehIGzezNeQuzihiBCvUEB3CVxHvsShF86wBWwQORNxNINlBPuq7rG4WWhNiTVHFg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
	
	<link href="https://fonts.googleapis.com/css2?family=Karma&family=Roboto&display=swap" rel="stylesheet">
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,500;1,200;1,300;1,400;1,500&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Titillium+Web&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Noto+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

	<script async src="https://www.googletagmanager.com/gtag/js?id=G-K273RE281C"></script>


	<style>

        /* GENERAL CSS */
 
        body {
            font-weight: 400;
            -moz-osx-font-smoothing: grayscale;
            -webkit-font-smoothing: antialiased;
            line-height: 1.4;
            font-size: 62.5%;
            font-family: "Noto Sans",Arial,Helvetica,sans-serif;
            scroll-behavior: smooth;
        }

        body > .bootstrap-select,
        body > .bootstrap-select > button {
            align-self: flex-start;
        }
        
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            color: #00011c;
        }

        ol, ul {
            list-style: none;
        }

        *, *:before, *:after {
            box-sizing: border-box;
        }



        /* CHATBOT CONTAINER */

        .fs-5-5{
			font-size: 1.7em;
            line-height: 1.6em;
		}

        .fs-5-6{
			font-size: 1.5em;
            line-height: 1.4em;
		}


        .survey_options{
            font-size: 1.7em;
        }



        .col-lg-0{
            width: 0;
            margin-left: 0;
        }

        #chatbot-container {
            /* width: 400px; */
            min-height: 460px;
            height: 100%;
            /* background-color: #ecf3fa; */
            /* text-align: center; */
            padding: 20px 20px 20px 0px;
            box-sizing: border-box;
            position: relative;
            z-index: 5;
        }


        /* Chat Box */

        .line-break {
            width: 100%;
        }

        .chatbot__overview {
            display: flex;
            flex-flow: row nowrap;
            align-content: space-between;
            margin: 0 auto;
            padding: 1em;
            padding-bottom: 0;
        }

        .chatlist {
            font-family: inherit;
            font-size: 1.6em;
            display: flex;
            flex-flow: column nowrap;
            align-items: flex-start;
            overflow-x: hidden;
            width: 100%;
            max-width: 35em;
            max-height: 90vh;
            margin: 0 auto;
        }

        .chatlist .userInput, .chatlist .bot__output {
            padding: 0.85em;
            margin: 0.5em;
            max-width: 100%;
            background-color: #fff;
            border-radius: 5px;
            border-bottom: 1px solid #777;
        }
        .chatlist .userInput {
            text-transform: lowercase;
            box-shadow: 1px 1px 2px #666;
            border-top: 4px solid #fa6767;
            opacity: 0;
            animation-name: animateBubble;
            animation-duration: 400ms;
            animation-iteration-count: 1;
            animation-play-state: running;
            animation-fill-mode: forwards;
        }
        .chatlist .bot__output {
            /* align-self: flex-start; */
            box-shadow: -1px 1px 2px #666;
            border-top: 4px solid #fa6767;
            will-change: auto;
            height: auto;
            opacity: 0;
            animation-name: animateBubble;
            animation-duration: 400ms;
            animation-iteration-count: 1;
            animation-play-state: paused;
            animation-fill-mode: forwards;
        }
        .chatlist .bot__output:last-child {
            display: none;
        }
        .chatlist .bot__command {
            color: #eeeeee;
            color: #27ae60;
            font-weight: 600;
            padding: 0.1em;
        }
        .chatlist .bot__output:nth-child(1) {
            animation-delay: 600ms;
            animation-play-state: running;
        }
        .chatlist .bot__output:nth-child(2) {
            animation-delay: 1200ms;
            animation-play-state: running;
        }
        .chatlist .bot__output:nth-child(3) {
            animation-delay: 1800ms;
            animation-play-state: running;
        }
        .chatlist .bot__output--standard:last-child {
            display: block;
        }
        .chatlist .bot__output--failed {
            display: block !important;
        }
        .chatlist .bot__output--second-sentence {
            display: block;
        }
        .chatlist .bot__outputImage {
            max-width: 16em;
            height: 12em;
        }

        @keyframes animateBubble {
            0% {
            transform: translateY(-20%);
            opacity: 0;
            }
            100% {
            transform: translateY(0);
            opacity: 1;
            }
        }



        /* Question Box */

		.qbox-shadow{
			box-shadow: 0 .125rem .25rem rgba(0,0,0,.075)!important;
		}
        
        #qbox-container {
            position: relative;
            padding: 30px;
            min-height: 420px;
            /* border-top: 15px solid #ecf3fa;
            border-bottom: 15px solid #ecf3fa;
            border-left: 15px solid #ecf3fa;
            border-right: 15px solid #ecf3fa;
			*/
			/* background-color: #fff; */
            color: #144b5e;
            z-index: 20;
			/* Add drop shadow */
			/* box-shadow: inset 0 0 1px 2px #ecf3fa; */
        }

		#qbox-container-inner {
			/* background-color: #fff; */
			/* margin: 5px; */
			/* box-shadow: 0 0 1px 2px #e0e0e0; */
		}

        @media (max-width: 992px) {
            #qbox-container {
                padding: 20px;
                /* border-left: 15px solid #ecf3fa;
                border-bottom: 15px solid #ecf3fa;
                border-right: 15px solid #ecf3fa; */
            }

            .fs-5-5{
                font-size: 1.8em;
            }
        }
        
        #steps-container {
            margin: auto;
            width: 90%;
            display: flex;
            vertical-align: middle;
            align-items: center;
			justify-content: space-around;
        }
        
        .step {
            display: none;
        }

        .step h4 {
            margin: 0 0 26px 0;
            padding: 0;
            position: relative;
            font-weight: 500;
            font-size: 23px;
            font-size: 1.4375rem;
            line-height: 1.6;
        }

        .resource_btn{
            display: inline-block;
            font-size: 18px;
            font-family: "Montserrat",Arial,Helvetica,sans-serif;
            font-weight: 700;
            height: 50px;
            line-height: 50px;
            padding: 0px 15px;
            background: #fa6767;
            margin: 0 auto;
            margin-top: 5px;
            margin-bottom: 5px;
            overflow: hidden;
            z-index: 1;
            cursor: pointer;
            text-decoration:none;
            transition: color .3s;
            text-align: center;
            color: #fff;
            border: 0;
            -webkit-border-radius: 50px;
            -moz-border-radius: 50px;
            border-radius: 50px;
            transition: color .1s ease,background-color .1s ease,opacity .1s ease;
        }
        
        .resource_btn:hover{
            text-decoration:none;
            color: #fff;
            background: #1fb4bb;
        }

        button#prev-btn,
        button#next-btn,
        button#submit-btn,
        button#sign-up-btn,
		button#feedback-btn {
            font-size: 17px;
            font-family: "Montserrat",Arial,Helvetica,sans-serif;
            font-weight: 700;
            position: relative;
            width: 130px;
            height: 50px;
            background: #055596;
            margin: 0 auto;
            margin-top: 10px;
            margin-bottom: 10px;
            overflow: hidden;
            z-index: 1;
            cursor: pointer;
            transition: color .3s;
            text-align: center;
            color: #fff;
            border: 0;
            -webkit-border-radius: 50px;
            -moz-border-radius: 50px;
            border-radius: 50px;
            transition: color .1s ease,background-color .1s ease,opacity .1s ease;
        }

		button#finish_reframing, button#get_new_suggestions_personalized, button#editor-submit, button#final-editor-submit{
			font-size: 16px;
			font-family: "Noto Sans",Arial,Helvetica,sans-serif;
			font-weight: 500;
			border-radius: 0.25rem !important;
			overflow: hidden;
            z-index: 1;
            cursor: pointer;
            transition: color .3s;
            text-align: center;
            color: #fff;
            border: 1px solid transparent;
			background: #055596;
			text-decoration: none;
			line-height: 1.5;
			padding: 0.375rem 0.75rem;
			transition: color .1s ease,background-color .1s ease,opacity .1s ease;

		}


		button#prev-btn{
			background: #e0e0e0 !important;
			color: #144b5e !important;
		}

		button#feedback-btn {
			width: 250px !important;
		}

        @media (hover: hover) and (pointer: fine) {

            button#prev-btn:hover,
            button#next-btn:hover,
            button#submit-btn:hover,
            button#sign-up-btn:hover,
			button#feedback-btn:hover,
			button#finish_reframing:hover,
			button#get_new_suggestions_personalized:hover,
			button#editor-submit:hover, 
			button#final-editor-submit:hover {
                background: #fa6767;
            }
        }

        .btn-outline-dark{
            border-color: #fa6767;
        }

        .btn-outline-dark:hover{
            background: #fa6767;
            border-color: #fa6767;
        }

        .progress {
            border-radius: 0px !important;
        }
        
        .q__question {
            position: relative;
        }
        
        .q__question:not(:last-child) {
            margin-bottom: 10px;
        }
        
        .question__input {
            position: absolute;
            left: -9999px;
        }
        
        .question__label {
            position: relative;
            display: block;
            /* line-height: 40px; */
            
            /* background-color: #fff; */
            padding: 10px 20px 5px 50px;
            cursor: pointer;
            
        }

        .q-box__question{
            border: 1px solid #ced4da;
            border-radius: 5px;
            transition: all 0.15s ease-in-out;
        }
        
        .q-box__question:hover {
            border: 1px solid #055596;
        }

        .q-box__border{
            border: 1px solid #055596;
        }
        
        .question__label:before,
        .question__label:after {
            position: absolute;
            content: "";
        }
        
        .question__label:before {
            top: 12px;
            left: 10px;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background-color: #fff;
            box-shadow: inset 0 0 0 1px #ced4da;
            -webkit-transition: all 0.15s ease-in-out;
            -moz-transition: all 0.15s ease-in-out;
            -o-transition: all 0.15s ease-in-out;
            transition: all 0.15s ease-in-out;
        }

        .question__input:checked+.question__label:before {
            background-color: #055596;
            box-shadow: 0 0 0 0;
        }
        
        .question__input:checked+.question__label:after {
            top: 22px;
            left: 18px;
            width: 10px;
            height: 5px;
            border-left: 2px solid #fff;
            border-bottom: 2px solid #fff;
            /* border: 2px solid #055596; */
            transform: rotate(-45deg);
        }
        
        .q-box__question.form-check-input:checked,
        .q-box__question.form-check-input:focus {
            background-color: #055596 !important;
            outline: none !important;
            border: none !important;
        }
        
        .q-box__question input:focus {
            outline: none;
        }
        
        #input-container {
            display: inline-block;
            box-shadow: none !important;
            margin-top: 36px !important;
        }
        
        label.form-check-label.radio-lb {
            margin-right: 15px;
        }
        
        #q-box__buttons {
            text-align: center;
        }
        
        
        .q-box__question.form-check-input:checked[type=radio],
        .q-box__question.form-check-input:checked[type=radio]:hover,
        .q-box__question.form-check-input:checked[type=radio]:focus,
        .q-box__question.form-check-input:checked[type=radio]:active {
            border: none !important;
            -webkit-outline: 0px !important;
            box-shadow: none !important;
        }
        
        .q-box__question.form-check-input:focus,
        .q-box__question input[type="radio"]:hover {
            box-shadow: none;
            cursor: pointer !important;
        }
        
        #success {
            display: none;
        }
        
        #success h4 {
            color: #055596;
        }
        
        .back-link {
            font-weight: 700;
            color: #055596;
            text-decoration: none;
            font-size: 18px;
        }
        
        .back-link:hover {
            color: #82000a;
        }

		button#refresh_btn {
            display: inline-block;
            padding: 0;
            border: 0;
            background: 0 0;
            text-decoration: none;
            text-align: center;
            color: #144b5e;
            text-transform: none;
            position: relative;
            font-family: "Noto Sans",Arial,Helvetica,sans-serif;
            font-weight: 700;
            font-size: 1em;
        }


        button#refresh_btn:after {
            content: "";
            display: block;
            width: 25%;
            height: 7px;
            margin-top: 5px;
            background: #fa6767;
            -webkit-transition: width .15s ease;
            -moz-transition: width .15s ease;
            -ms-transition: width .15s ease;
            -o-transition: width .15s ease;
            transition: width .15s ease;
        }

        button#refresh_btn:hover:after{
                width: 100%;
                transition: width .15s ease;
        }


		button#loadMoreCD, button#more_suggestions_btn {
            display: inline-block;
            padding: 0;
            border: 0;
            background: 0 0;
            text-decoration: none;
            text-align: center;
            color: #144b5e;
            text-transform: none;
            position: relative;
            font-family: "Noto Sans",Arial,Helvetica,sans-serif;
            font-weight: 700;
            font-size: 1em;
        }


        button#loadMoreCD:after, button#more_suggestions_btn:after {
            content: "";
            display: block;
            width: 25%;
            height: 7px;
            margin-top: 5px;
            background: #fa6767;
            -webkit-transition: width .15s ease;
            -moz-transition: width .15s ease;
            -ms-transition: width .15s ease;
            -o-transition: width .15s ease;
            transition: width .15s ease;
        }

        button#loadMoreCD:hover:after, button#more_suggestions_btn:hover:after{
                width: 100%;
                transition: width .15s ease;
        }


        button#start_over,
		button#start_over_mobile {
            display: inline-block;
            padding: 0;
            border: 0;
            background: 0 0;
            text-decoration: none;
            text-align: center;
            color: #144b5e;
            text-transform: none;
            position: relative;
            font-family: "Noto Sans",Arial,Helvetica,sans-serif;
            font-weight: 700;
            font-size: 1em;
        }


        button#start_over:after,
		button#start_over_mobile:after {
            content: "";
            display: block;
            width: 35%;
            height: 7px;
            margin-top: 5px;
            background: #fa6767;
            -webkit-transition: width .15s ease;
            -moz-transition: width .15s ease;
            -ms-transition: width .15s ease;
            -o-transition: width .15s ease;
            transition: width .15s ease;
        }

        button#start_over:hover:after,
		button#start_over_mobile:hover:after {
                width: 100%;
                transition: width .15s ease;
        }
		


        #start_over_div{
            text-align: left;
            margin-left: 20px;
            margin-top: 10px;
        }

		#start_over_div_mobile{
			text-align: center;
            margin-top: 10px;
        }

        @media (max-width: 767px) {
            #start_over_div{
                text-align: center;
                margin-left: 0;
                margin-top: 10px;
            }
        }


        button#try_again {
            display: inline-block;
            padding: 0;
            border: 0;
            background: 0 0;
            text-decoration: none;
            text-align: center;
            color: #144b5e;
            text-transform: none;
            position: relative;
            font-family: "Noto Sans",Arial,Helvetica,sans-serif;
            font-weight: 700;
            font-size: 1em;
        }


        button#try_again:after {
            content: "";
            display: block;
            width: 15%;
            height: 7px;
            margin-top: 5px;
            background: #fa6767;
            -webkit-transition: width .15s ease;
            -moz-transition: width .15s ease;
            -ms-transition: width .15s ease;
            -o-transition: width .15s ease;
            transition: width .15s ease;
        }

        button#try_again:hover:after{
                width: 35%;
                transition: width .15s ease;
        }


        .feedback_wrapper{
            font-size: 1.5em;
        }

        .feedback_radio_group input[type="radio"]{
            opacity: 0;
            cursor: pointer;
            transition: transform 0.7s ease;
        }

        .feedback_radio_group input[type="radio"] + label{
            color: #95a5a6;
            cursor: pointer;
            transform: scale(0.8);
        }

        .feedback_radio_like input[type="radio"]:checked + label{
            color: #fa6767;
            transform: scale(0.9);
        }

        .feedback_radio_like input[type="radio"]:hover + label{
            /* color: #fa6767; */
            transform: scale(0.9);
        }

        .feedback_radio_dislike input[type="radio"]:checked + label{
            color: #fa6767;
            transform: scale(0.9);
        }

        .feedback_radio_flag input[type="radio"]:checked + label{
            color: #c62828;
            transform: scale(0.9);
        }

        .feedback_radio_flag input[type="radio"]:hover + label{
            /* color: #c62828; */
            transform: scale(0.9);
        }


        .col-lg-7 {
            /* flex-shrink: 1; */
            transition: all 250ms ease;
        }

        .col-lg-9 {
            /* flex-grow: 1; */
            transition: all 250ms ease;
        }

        /* .multiselect-container {
            width: 100% !important;
        } */

        /* .bootstrap-select:not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn){
            width:100% !important;
        } */


        .bootstrap-select.btn-group {width: auto !important;}

        .dropdown-menu.open{width:100%}

		.checkbox-lg .custom-control-label::before, 
		.checkbox-lg .custom-control-label::after {
		top: .8rem;
		width: 1.55rem;
		height: 1.55rem;
		}

		.checkbox-lg .custom-control-label {
		padding-top: 13px;
		padding-left: 6px;
		}


		.checkbox-xl .custom-control-label::before, 
		.checkbox-xl .custom-control-label::after {
		top: 1.2rem;
		width: 1.85rem;
		height: 1.85rem;
		}

		.checkbox-xl .custom-control-label {
		padding-top: 23px;
		padding-left: 10px;
		}


		#thought,#situation,#feedback{
			border: 0;
			width: 100%;
			background: 0 0;
			padding: 0;
			font-size: 16px;
			color: #000;
			font-weight: 400;
			border-bottom: 4px solid #144b5e;
			-webkit-box-shadow: none;
			-moz-box-shadow: none;
			box-shadow: none;
			-webkit-border-radius: 0;
			-moz-border-radius: 0;
			border-radius: 0;
			transition: border-bottom .3s ease;
		}

		#thought:focus,#situation:focus, #feedback:focus{
			outline: none;
			border-bottom: 4px solid #fa6767;
			-webkit-box-shadow: none;
			-moz-box-shadow: none;
			box-shadow: none;
			width: 100%;
			transition: 0.4s;
		}


		.reframe-edit-div{
			border: solid 1px #d6d8de;
			border-radius: 12px;
			background: white;
			overflow: hidden;
		}

		#more_help_reframe_personalized{
			border: solid 1px #d6d8de;
			border-radius: 12px;
			background: white;
			overflow: hidden;
		}

		#rational_response_text, #rational_response_text_orig{
			width: 100%;
			border: none;
			resize: none;
			outline: none !important;
			padding: 24px 10px 10px 24px;
			box-sizing: border-box;
			min-height: 125px;
			line-height: 1.75;
			background-color: white;
			overflow: auto;
			margin: 0;
			font-size: 16px;
			color: #000;
			font-weight: 400;
		}


		#personalized_context{
			width: 100%;
			border: none;
			resize: none;
			outline: none !important;
			padding: 24px 10px 10px 24px;
			box-sizing: border-box;
			min-height: 85px;
			line-height: 1.75;
			background-color: white;
			overflow: auto;
			margin: 0;
			font-size: 16px;
			color: #000;
			font-weight: 400;
		}

		#rational_response_text_footer{
			color: #787a80;
			display: flex;
			padding: 4px 18px 14px 24px;
			/* position: relative; */
			/* font-size: 13px; */
			/* align-items: center; */
			justify-content: space-between;
		}

		#more_help_reframe_personalized_footer{
			color: #787a80;
			display: flex;
			padding: 4px 18px 14px 24px;
			/* position: relative; */
			/* font-size: 13px; */
			/* align-items: center; */
			justify-content: space-between;
		}

		#finish_reframing{
			margin-left: auto;
		}

		#get_new_suggestions_personalized{
			margin-left: auto;
		}

		/* #additional_context_button{
			color: #ffffff;
			outline: none !important;
			padding: 10px 14px;
			z-index: 3;
			font-size: 17px;
			transition: 0.15s all;
			align-items: center;
			border-radius: 4px;
			flex-direction: row;
			text-transform: none;
			justify-content: center;
			background-color: #8b0abe;
		} */

		/* #rational_response_text{
			min-height: 100px;
		} */

		/* #rational_response_text{
			border: 0;
			width: 100%;
			background: 0 0;
			min-height: 100px;
			font-size: 16px;
			color: #000;
			font-weight: 400;
			border-bottom: 4px solid #144b5e;
			-webkit-box-shadow: none;
			-moz-box-shadow: none;
			box-shadow: none;
			-webkit-border-radius: 0;
			-moz-border-radius: 0;
			border-radius: 0;
			transition: border-bottom .3s ease;
		}

		#rational_response_text:focus{
			outline: none;
			border-bottom: 4px solid #fa6767;
			-webkit-box-shadow: none;
			-moz-box-shadow: none;
			box-shadow: none;
			width: 100%;
			transition: 0.4s;
		} */

		/* .effect-2 {
			border: 0;
			padding: 7px 0;
			border-bottom: 4px solid #144b5e;
		} */


		/* .effect-2~.focus-border {
			position: absolute;
			bottom: 0;
			left: 50%;
			width: 0;
			height: 2px;
			background-color: #fa6767;
			transition: 0.4s;
		}
		
		.effect-2:focus~.focus-border {
			width: 100%;
			transition: 0.4s;
			left: 0;
		} */



		
		
		/* Skeleton */
		.skeleton {
			display: inline-block;
			height: 1em;
			position: relative;
			overflow: hidden;
			background-color: #f5f5f5;
			border-radius: 2px;
			}

			.skeleton::after {
			position: absolute;
			top: 0;
			right: 0;
			bottom: 0;
			left: 0;
			transform: translateX(-100%);
			background-image: linear-gradient(90deg, #e0e0e0, #eeeeee, #e0e0e0);
			animation: skeleton-loading 1.5s ease-in-out infinite;
			content: "";
			}


		@keyframes skeleton-loading {
			100% {
				transform: translateX(100%);
			}

		}

		.skeleton-text {
			width: 100%;
			height: 0.7rem;
			margin-bottom: 0.5rem;
			border-radius: 0.25rem;
		}

		.skeleton-text__body {
			width: 100%;
		}


		/* Side-Step */

		.side-step {
			position: relative;
			min-height: 1em;
			color: #e0e0e0;
			-webkit-transition: color 0.4s ease;
			-moz-transition: color 0.4s ease;
			transition: color 0.4s ease;
		}

		.side-title {
			font-size: 1.1em;
			margin-bottom: 10px;
			/* line-height: 1.5em; */
			font-weight: bold;
		}
		.side-caption {
			font-size: 0.8em;
			height: 50px;
		}

		.side-step + .side-step {
			margin-top: 1.5em
		}

		.side-step > div:first-child {
			position: static;
			height: 0;
		}

		.side-step > div:not(:first-child) {
			margin-left: 1.5em;
			padding-left: 1em;
		}

		.side-circle {
			background: #e0e0e0;
			position: relative;
			width: 1.5em;
			height: 1.5em;
			line-height: 1.5em;
			border-radius: 100%;
			color: #fff;
			text-align: center;
			box-shadow: 0 0 0 3px #fff;
		}

		.side-circle:after {
			content: ' ';
			position: absolute;
			display: block;
			top: 1px;
			right: 50%;
			bottom: 2px;
			left: 50%;
			height: 50px;
			width: 1px;
			transform: scale(1, 2);
			transform-origin: 50% -50%;
			background-color: rgba(0, 0, 0, 0.25);
			z-index: -1;
		}

		.side-step:last-child .side-circle:after {
			display: none
		}

		.side-step.side-step-active {
			color: #144b5e;
		}
		.side-step.side-step-active .side-circle {
			background-color: #144b5e;
		}

		.side-step.side-step-done {
			color: #bdbdbd;
		}
		.side-step.side-step-done .side-circle {
			background-color: #e0e0e0;
		}

		.button_radio {
			float: left;
			margin: 10px 10px 0 0;
			padding: 0.375rem 0.75rem;
			width: 47px;
			height: 40px;
			position: relative;
		}

		.button_radio label,
		.button_radio input {
			display: block;
			position: absolute;
			cursor: pointer;			
			line-height: 1.5;
			padding: 0.375rem 0.75rem;
			border-radius: 5px;
			border: 1px solid #055596;
			color: #055596;
			cursor: pointer;
			transition: color .1s ease,background-color .1s ease,opacity .1s ease;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
		}

		.button_radio label{
			display: inline-block;
			font-weight: 400;
			line-height: 1.5;
			text-align: center;
			text-decoration: none;
			vertical-align: middle;
			cursor: pointer;
			-webkit-user-select: none;
			-moz-user-select: none;
			user-select: none;
			background-color: transparent;
			padding: 0.375rem 0.75rem;
			font-size: 1rem;
			border-radius: 0.25rem;
		}

		.button_radio input[type="radio"] {
			opacity: 0.011;
			z-index: 100;
		}

		.button_radio input[type="radio"]:checked + label {
			background: #055596;
			color: #fff;
			border-radius: 5px;
		}

		.button_radio input[type="radio"]:hover + label {
			background: #055596;
			color: #fff;
			border-radius: 5px;
		}

		.button_radio label {
			z-index: 90;
		}


		blockquote {
			font-size: 1.8em;
			margin-top: 10px;
			margin-bottom: 10px;
			margin-left: 50px;
			padding-left: 15px;
			border-left: 5px solid #9e9e9e;
			display:inline-flex;
		} 

		blockquote span {
			margin-top:-10px;
			margin-bottom:-10px;
		}



		/* @media (hover: hover) and (pointer: fine) {
			.button_radio:hover {
					background-color: #055596;
					color: #fff;
				}
		} */

        /* MEDIA QUERIES */
        
        @media (min-width: 990px) and (max-width: 1199px) {
            /* #chatbot-container {
                padding: 80px 28px 28px 28px;
            } */
            #steps-container {
                width: 85%;
            }
            
        }
        
        @media (max-width: 992px) {
            #chatbot-container {
                min-height: inherit;
                padding-top: 10px;
            }

            #chatbot-container{
                display: none;
            }

        }
        
		@media (min-width: 992px){
			#start_over_div_mobile{
				display: none;
			}
		}


        @media (max-width: 700px) {
            #steps-container {
                width: 100%;
                /* min-height: 400px; */
				display: block;
            }
        }

		
        
      </style>



    </head>

    <body>

        <script>

			const { jsPDF } = window.jspdf;

            $(document).ready(function(){

                var debug = false;
var win =$(window);
                var mobile_width = 992;

				var thought_record_id = '{{ thought_record_id }}';

				var thought_id = '';
				var situation_id = 0;
				var thinking_trap_generated_id = 0;
				var thinking_trap_selected_id = 0;
				var reframes_generated_id = 0;
				var reframe_selected_id = 0;
				var reframe_final_id = 0;


				if(debug) console.log('thought_record_id: ' + thought_record_id);


				var thought = '';
				var situation = '';
				var cognitive_distortion_category = 'None of These Thinking Traps Seem Right to Me';
				var rational_response = '';

                var thought_final = "";
                var situation_final = "";
                var thinking_trap_final = "";
                var rational_response_final = "";

				var belief = "";
				var emotion = "";
				var emotion_strength = "";

				var reframed_thought_1 = "";
				var reframed_thought_2 = "";
				var reframed_thought_3 = "";

				var prompt_type_1 = "";
				var prompt_type_2 = "";
				var prompt_type_3 = "";

				var curr_theme = "";

				var this_is_a_difficult_situation = 0;

				var skip_step = '{{ skip_step }}';
				var skip_step_li = {{ skip_step_li|safe }};

				if(debug) console.log('skip_step_li: ' + skip_step_li);
				

				var remove_negative_feeling = '{{ remove_negative_feeling }}';
				var prompt_to_use = '{{ prompt_to_use }}';
				if(debug) console.log('prompt_to_use: ' + prompt_to_use);

				var refresh_btn = '{{ refresh_btn }}';
				if(debug) console.log('refresh_btn: ' + refresh_btn);

				var more_suggestions_btn = '{{ more_suggestions_btn }}';
				if(debug) console.log('more_suggestions_btn: ' + more_suggestions_btn);

				if(debug) console.log('remove_negative_feeling: ' + remove_negative_feeling);

				var descriptive_thought_Q = '{{ descriptive_thought_Q }}';
				if(debug) console.log('descriptive_thought_Q: ' + descriptive_thought_Q);

				var multiple_cognitive_distortions = '{{ multiple_cognitive_distortions }}';
				if(debug) console.log('multiple_cognitive_distortions: ' + multiple_cognitive_distortions);

				var A_A = '{{ A_A }}';
				if(debug) console.log('A_A: ' + A_A);

				var extra_q = '{{ extra_q }}';
				if(debug) console.log('extra_q: ' + extra_q);

				var emotion_questions = '{{ emotion_questions }}';
				if(debug) console.log('emotion_questions: ' + emotion_questions);

				var personalize = '{{ personalize }}';
				if(debug) console.log('personalize: ' + personalize);

				var readable = '{{ readable }}';
				if(debug) console.log('readable: ' + readable);

				var psychoeducation = '{{ psychoeducation }}';
				if(debug) console.log('psychoeducation: ' + psychoeducation);

				var ai = '{{ai}}';
				if(debug) console.log('ai: ' + ai);

				var cognitive_distortion_category_li = [];
				var distortion_definition_li = [];

				var currentlyCheckedCount = 0;

				window.dataLayer = window.dataLayer || [];
				
				function gtag(){dataLayer.push(arguments);}
					gtag('js', new Date());
					gtag('config', 'G-K273RE281C', {
						'send_page_view': false,
        				'cookie_flags': 'SameSite=None;Secure'
				});


				var ALL_CD = ["All-or-Nothing Thinking", 
							"Overgeneralizing",
							"Labeling",
							"Fortune Telling",
							"Mind Reading",
							"Emotional Reasoning",
							"Should Statements",
							"Personalizing",
							"Disqualifying the Positive",
							"Catastrophizing",
							"Catastrophizing",
							"Comparing and Despairing",
							"Blaming",
							"Negative Feeling or Emotion",]



				var DISTORTION_DEFINITIONS = {
					"All-or-Nothing Thinking": "Things in life are rarely black and white. There are shades of gray—and all sorts of other colors too! To break free from all-or-nothing thinking, focus on what's positive or neutral about the situation. \"Maybe I didn't get an A, but a C is still a passing grade. Now I know that this subject is hard for me, and I may need to spend more time studying.\"", 
					"Overgeneralizing": "We often notice when things go wrong—and forget about the times they went right. Even if things have gone wrong many times in the past, that doesn't mean they will stay that way. Try to recall times when things went well for you. Imagine what it would be like for things to go well next time.",
					"Labeling": "People are complex. None of us have just one thing that defines us. To break free from labeling, consider all different aspects of a person. \"I may not be the most outgoing person, but I'm a good friend to the people closest to me.\"",
					"Fortune Telling": "No one can predict the future. To break free from fortune telling, be curious about what's going to happen next. Focus on what you can control, and let go of what you can't.",
					"Mind Reading": "No one can know what other people are thinking. To break free from mind reading, try to imagine other, less negative possibilities. \"She didn't say hello, but maybe she just didn't hear me.\" When possible, try to ask the person what they're thinking, rather than just assuming.",
					"Emotional Reasoning": "Our feelings provide valuable information to us, but they're only part of the picture. To break free from emotional reasoning, consider all the information you have.",
					"Should Statements": "To break free from \"should\" statements, think about where your unrealistic expectations came from. Has someone told you that you need to be a certain way? It's a good thing to want to be your \"best self.\" But we all make mistakes along the way. Let your mistakes be an opportunity to learn and grow.",
					"Personalizing": "As humans, we all have a tendency to think that we have more impact on other people than we really do. To break free from personalization, think about all the other things that could be affecting someone's behavior. \"Maybe they're just having a bad day. Maybe they're distracted.\"",
					"Disqualifying the Positive": "To break free of this thinking trap, go out of your way to notice the positive side. For every negative thing you notice, try pointing out three positive things. At first, it may feel forced, but over time you'll find yourself noticing the small things and feeling more grateful.",
					"Magnification": "In magnification, when you evaluate yourself, another person, or a situation., you unreasonably magnify the negative and/or minimize the positive.",
					"Catastrophizing": "Keep in mind that worst-case scenarios are very unlikely. Try to remind yourself of all the more likely, less severe things that could happen. Expecting the worst can even become a self-fulfilling prophecy. It's okay to be prepared, but try to go into situations expecting a positive outcome.",
					"Comparing and Despairing": "It's best not to compare yourself to others at all—but that's easier said than done. Remember that what you see on social media and in public is everyone showing off their best. You don't see their worst—and they probably don't see yours.",
					"Blaming": "Take responsibility for whatever you can—no more, no less. \"It was okay for me to feel angry in that situation. But I didn't have to take it out on everyone else. Next time, I'll try taking a deep breath before I act.\" And remember: blaming yourself is still blaming! Try to think less of whose fault it is, and focus instead on what you can do to make things better.",
					"Not Distorted": "The thought doesn't seem distorted.",
					"Negative Feeling or Emotion": "Feeling negative emotions is a normal part of life. Sometimes we get \"stuck\" in those feelings and don't know how to move forward. First, it's important to allow ourselves to feel these emotions and to accept them for what they are. To get un-stuck, it helps to think about what we can control, and what positive things we can be grateful for.",
					"None of These Thinking Traps Seem Right to Me": "That's okay—we'll give you the space to work through your negative thought in whatever way makes sense to you.",
				};

				var DISTORTION_SUBTEXT = {"All-or-Nothing Thinking": "Thinking in extremes. \"If it isn't perfect, I failed. There's no such thing as 'good enough'.\"", 
				"Blaming": "Giving away your own power to other people. \"It's not my fault I yelled. You made me angry!\"",
				"Catastrophizing": "Focusing on the worst-case scenario. \"My boss asked if I had a few minutes to talk. I'm going to get fired!\"",
				"Comparing and Despairing": "Comparing your worst to someone else's best.",
				"Disqualifying the Positive": "When something good happens, you ignore it or think it doesn't count. \"I only won because I got lucky.\"",
				"Emotional Reasoning": "Treating your feelings like facts. \"I woke up feeling anxious. I just know something bad is going to happen today.\"",
				"Fortune Telling": "Trying to predict the future. Focusing on one possibility and ignoring other, more likely outcomes.",
			"Labeling": "Defining a person based on one action or characteristic. \"I said something embarrassing. I'm such a loser.\"",
			"Mind Reading": "Assuming you know what someone else is thinking. \"She didn't say hello. She must be mad at me.\"",
			"Negative Feeling or Emotion": "Getting \"stuck\" on a distressing thought, emotion, or belief.",
			"Overgeneralizing": "Jumping to conclusions based on one experience. \"They didn't text me back. Nobody ever texts me back.\"",
			"Personalizing": "Taking things personally or making them about you. \"He's quiet today. I wonder what I did wrong.\"",
			"Should Statements": "Setting unrealistic expectations for yourself. \"I shouldn't need to ask for help. I should be independent.\"",
			"None of These Thinking Traps Seem Right to Me": "That's okay—we'll give you the space to work through your negative thought in whatever way makes sense to you."}


				function typeName(name, iteration, caption_id) {
					// Prevent our code executing if there are no letters left
					if (iteration === name.length)
						return;

					setTimeout(function() {
						// Set the name to the current text + the next character
						// whilst incrementing the iteration variable
						$('#' + caption_id).text( $('#' + caption_id).text() + name[iteration++] );

						// Re-trigger our function
						typeName(name, iteration, caption_id);
					}, 10);
				}



				function disableRemainingCheckboxes() {
					Array.from(document.querySelectorAll('input[name="cognitive_distortion_category"]:not(:checked)')).forEach(function(element) {
						element.disabled = 'disabled';
					})
				}

				function enableAllCheckboxes() {
					Array.from(document.querySelectorAll('input[name="cognitive_distortion_category"]')).forEach(function(element) {
						element.disabled = undefined
					})
				}

				function onCheckboxClick() {
					if(this.checked) {
						currentlyCheckedCount++
					} else {
						currentlyCheckedCount--
					}

					if(debug) console.log('currentlyCheckedCount:', currentlyCheckedCount);
					
					if(currentlyCheckedCount >= 3) {
						disableRemainingCheckboxes()
					} else {
						enableAllCheckboxes()
					}
				}

				var doc = new jsPDF('portrait', 'pt', 'a4', true);

				var margins = {
						top: 40,
						bottom: 60,
						left: 40,
						width: 522
					};

				$('#editor-submit').click(function () {

				var curr_content = document.querySelector("#save-content");

				// add datetime to top of curr_content
				var curr_datetime = moment().format('MMMM Do YYYY, h:mm a');

				$("#save-content-header").html('<strong>' + curr_datetime + '</strong>');

				// curr_content.innerHTML = '<p class="fs-5-5 my-1"><b>Date:</b> <i>' + curr_datetime + '</i></p>' + curr_content.innerHTML;

				html2canvas(curr_content).then(canvas => {
					// save canvas image
					var link = document.createElement('a');

					var datetime = new Date();

					link.download = 'thought-record-' + datetime.toLocaleDateString() + '.png';
					link.href = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
					link.click();


				});

				});

				$('#final-editor-submit').click(function () {

				var curr_content = document.querySelector("#save-content-final");

				var curr_datetime = moment().format('MMMM Do YYYY, h:mm a');

				$("#save-content-final-header").html('<strong>' + curr_datetime + '</strong>');

				// // add datetime to top of curr_content
				// var curr_datetime = moment().format('MMMM Do YYYY, h:mm a');

				// curr_content.innerHTML = '<p class="fs-5-5 my-1"><b>Date:</b> <i>' + curr_datetime + '</i></p>' + curr_content.innerHTML;


				html2canvas(curr_content).then(canvas => {
					// save canvas image
					var link = document.createElement('a');
					var datetime = new Date();

					link.download = 'thought-record-' + datetime.toLocaleDateString() + '.png';

					link.href = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
					link.click();
				});


				});



                // Rational Response New
             $('div').on('click', 'input:radio[name=rational_response]', function (event) {
					event.stopPropagation();
                    event.stopImmediatePropagation();

                    $editor = $("#rational_response_editable");
                    if (this.value == 'new') {                        
                        if(debug) console.log($editor.text());
                        if ($editor.text() === "Add your own reframe"){
                            $editor.html('');
                            $editor.css({'color': '#144b5e'});
                        }
                        $editor.focus();
                    }

                    else{
                        if ($editor.text() === ""){
                            $editor.html('Add your own reframe');
                            $editor.css({'color': '#9e9e9e'});
                        }
                    }
                });

				$('div').on('click', '.feedback_radio_flag_input', function(event){
					var curr_reframe = this.value;

					$.ajax({
						url: "{% url 'diy_tool:save_flag_inappropriate' %}",
						type: "GET",
						dataType: "json",
						data: {
							thought_record_id: thought_record_id,
							reframe: curr_reframe, 
							},
						success : function(data) {
							if(debug) console.log('flagged ' + data['delete_label']);
						},
						error : function(xhr, errmsg, err) {
							if(debug) console.log('not flagged');
						}
					});
				});


				$('div').on('click', '.ext_url', function(event){
					event.stopPropagation();
                    event.stopImmediatePropagation();

					$.ajax({
						url: "{% url 'diy_tool:save_url_clicks' %}",
						type: "GET",
						dataType: "json",
						data: {
							thought_record_id: thought_record_id,
							url_text: $(this).text(),
							},
						success : function(data) {
							if(debug) console.log('saved url click');
						},
						error : function(xhr, errmsg, err) {
							if(debug) console.log('not saved url click');
						}
					});
				});



				$('div').on("click", '#tips_heading', function(event) {
					event.stopPropagation();
                    event.stopImmediatePropagation();
					$("#collapseOne").collapse('toggle');

					$.ajax({
						url: "{% url 'diy_tool:save_url_clicks' %}",
						type: "GET",
						dataType: "json",
						data: {
							thought_record_id: thought_record_id,
							url_text: $(this).text(),
							},
						success : function(data) {
							if(debug) console.log('saved url click');
						},
						error : function(xhr, errmsg, err) {
							if(debug) console.log('not saved url click');
						}
					});
				});



                $('div').on('change', '#consent', function () {
                    if($("#consent").is(':checked')){
                        $("#empty_consent").fadeOut(200);
                    }
                });


				$('div').on('click', '#refresh_btn', function(event){

					event.stopPropagation();
					event.stopImmediatePropagation();

					$.ajax({
						url: "{% url 'diy_tool:save_refresh_btn' %}",
						type: "GET",
						dataType: "json",
						data: {
							thought_record_id: thought_record_id,
							},
						success : function(data) {
							if(debug) console.log('saved refresh click');
						},
						error : function(xhr, errmsg, err) {
							if(debug) console.log('not saved refresh click');
						}
					});

					refresh_rational_response(situation, thought, cognitive_distortion_category);
				});


				$('div').on('click', '#more_suggestions_btn', function(event){

					event.stopPropagation();
					event.stopImmediatePropagation();

					$.ajax({
						url: "{% url 'diy_tool:save_refresh_btn' %}",
						type: "GET",
						dataType: "json",
						data: {
							thought_record_id: thought_record_id,
							},
						success : function(data) {
							if(debug) console.log('saved more suggestions click');
						},
						error : function(xhr, errmsg, err) {
							if(debug) console.log('not saved more suggestions click');
						}
					});

					add_suggestions_rational_response(situation, thought, cognitive_distortion_category_li);
				});


				// on feedback btn click
				$('div').on('click', '#feedback-btn', function(event){
					event.stopPropagation();
					event.stopImmediatePropagation();

					// Get feedback input text
					var feedback_text = $('#feedback').val();

					// if empty show empty_feedback div

					if (feedback_text == ""){
						$('#empty_feedback').fadeIn(300);
						return;
					}


					$.ajax({
						url: "{% url 'diy_tool:save_feedback' %}",
						type: "GET",
						dataType: "json",
						data: {
							thought_record_id: thought_record_id,
							feedback: feedback_text,
							},
						success : function(data) {
							if(debug) console.log('saved feedback click');
						},
						error : function(xhr, errmsg, err) {
							if(debug) console.log('not saved feedback click');
						}
					});

					// Change feedback card to show feedback was submitted with fade
					$('#feedback-card').fadeOut(300, function(){
						$('#feedback-card').html('<p class="card-text fs-5-5">Thank you for your feedback! We appreciate your help in making this tool better.</p>');
						$('#feedback-card').fadeIn(300);
					});

				});


                $('div').on('click', '.other_thoughts_btn', function(event){
                    event.stopPropagation();
                    event.stopImmediatePropagation();

                    if(debug) console.log('button clicked');
                    $('#thought').val($(this).html());
                    $(nextBtn).trigger('click');
                });


                $('div').on('click', '.q-box__question input[name="cognitive_distortion_category"]', function(event){

                    var $radios = $('input[type="radio"]');

                    var $this = $(this);
                    var $otherRadios = $radios.not($this).filter('[name="'
                                                                + $this.attr('name') + '"]');

                    if($this.is(':checked')){
                        $(this).parent().addClass('q-box__border');
                        $otherRadios.parent().removeClass('q-box__border')
                    }
					else{
						$(this).parent().removeClass('q-box__border');
					}
						

                });


				$('div').on('click', 'input[name="rational_response"]', function(event){

					var $radios = $('input[type="radio"]');

					if(debug) console.log('radio clicked');

					var $this = $(this);
					var $otherRadios = $radios.not($this).filter('[name="'
																+ $this.attr('name') + '"]');

					if($this.is(':checked')){
						$(this).parent().addClass('q-box__border');
						$otherRadios.parent().removeClass('q-box__border');
					}

				});


                $('div').on('click', '.feedback_radio_group input[type="radio"]', function(event){
                    event.stopPropagation();
                    // event.stopImmediatePropagation();
                    var $radios = $('input[type="radio"]');

                    var $this = $(this);

                    // if this was previously checked
                    if ($this.data('checked')) {
                        this.checked = false;
                    }
                    var $otherRadios = $radios.not($this).filter('[name="'
                                                                + $this.attr('name') + '"]');
                    $otherRadios.prop('checked', false).data('checked', false);
                    $this.data('checked', this.checked);
                });

				// show div "more_help_reframe_personalized" when "personalized" option in more_help_reframe select is selected
				$('div').on('change', '#more_help_reframe', function (event) {
					// stop propagation
					event.stopPropagation();
					event.stopImmediatePropagation();

					var curr_rational_response = $("#rational_response_text").val();

					$("#empty_improved_reframe_context").hide();

					if($("#more_help_reframe").val() == "personalized"){
						$("#new_suggestions").hide();
						$("#more_help_reframe_personalized").fadeIn(200);
					}
					

					else if($("#more_help_reframe").val() == "actionable"){
						// empty new_suggestions div
						$("#more_help_reframe_personalized").hide();
						$("#new_suggestions").hide();
						$("#new_suggestions").empty();

						// call more_help_rational_response
						more_help_rational_response(situation, thought, cognitive_distortion_category_li, curr_rational_response, 'actionable', '');
					}

					else if($("#more_help_reframe").val() == "empathic"){
						// empty new_suggestions div
						$("#more_help_reframe_personalized").hide();
						$("#new_suggestions").hide();
						$("#new_suggestions").empty();

						// call more_help_rational_response
						more_help_rational_response(situation, thought, cognitive_distortion_category_li, curr_rational_response, 'empathic', '');
					}

					else{
						$("#more_help_reframe_personalized").hide();
						$("#new_suggestions").hide();
					}


				});


				$("div").on('click', '#get_new_suggestions_personalized', function(event){
					event.stopPropagation();
					event.stopImmediatePropagation();

					// get personalized reframe
					var personalized_context = $("#personalized_context").val();
					var curr_rational_response = $("#rational_response_text").val();

					// if empty show empty_feedback div

					if (personalized_context == ""){
						$("#empty_improved_reframe_context").fadeIn(300);
						return;
					}

					$("#empty_improved_reframe_context").hide();

					// call more_help_rational_response

					$("#new_suggestions").hide();
					$("#new_suggestions").empty();

					more_help_rational_response(situation, thought, cognitive_distortion_category_li, curr_rational_response, 'personalized', personalized_context);

				});

				$('div').on('click', '.copy_reframe', function(event){
					// Copy button value to clipboard
					event.stopPropagation();
					event.stopImmediatePropagation();

					var $temp = $("<input>");
					$("body").append($temp);
					$temp.val($(this).val()).select();
					document.execCommand("copy");
					$temp.remove();

					// change to button to btn-success and text to tick + copied. Do it with an animation
					$(this).removeClass('btn-light');
					$(this).addClass('btn-success');
					$(this).html('<i class="fas fa-check"></i> copied');
					$(this).prop('disabled', true);

					$.ajax({
						url: "{% url 'diy_tool:save_url_clicks' %}",
						type: "GET",
						dataType: "json",
						data: {
							thought_record_id: thought_record_id,
							url_text: "copied -- " + $(this).val(),
							},
						success : function(data) {
							if(debug) console.log('saved url click');
						},
						error : function(xhr, errmsg, err) {
							if(debug) console.log('not saved url click');
						}
					});

				});


				$('div').on('click', '.add_reframe', function(event){
					event.stopPropagation();
					event.stopImmediatePropagation();

					// get exisiting rational response
					var curr_rational_response = $("#rational_response_text").val();

					// remove trailing whitespaces
					curr_rational_response = curr_rational_response.trim();

					$("#rational_response_text").fadeOut(200);
					$("#rational_response_text").val(curr_rational_response + ' ' +  $(this).val());
					$("#rational_response_text").fadeIn(200);

					// hide new_suggestions and more_help_reframe_personalized

					$("#new_suggestions").hide();
					$("#more_help_reframe_personalized").hide();


					// reset #more_help_reframe which is a select
					$("#more_help_reframe").val('');
					$("#more_help_reframe").selectpicker("destroy");
					$("#more_help_reframe").selectpicker("render");

					$("#continue_help").fadeIn(100);

					// change to button to btn-success and text to tick + copied. Do it with an animation
					$(this).removeClass('btn-light');
					$(this).addClass('btn-success');
					$(this).html('<i class="fas fa-check"></i> added');
					$(this).prop('disabled', true);

					var textarea = document.querySelector('#rational_response_text');
					resizeTextArea(textarea, userDefinedHeight);

					$.ajax({
						url: "{% url 'diy_tool:save_url_clicks' %}",
						type: "GET",
						dataType: "json",
						data: {
							thought_record_id: thought_record_id,
							url_text: "added_to_the_reframe -- " + $(this).val(),
							},
						success : function(data) {
							if(debug) console.log('saved url click');
						},
						error : function(xhr, errmsg, err) {
							if(debug) console.log('not saved url click');
						}
					});

				});


				

				$('div').on('click', '.update_reframe', function(event){
					// Copy button value to clipboard
					event.stopPropagation();
					event.stopImmediatePropagation();

					// change '#rational_response_text' to the value of this button with animation
					$("#rational_response_text").fadeOut(200);
					$("#rational_response_text").val($(this).val());
					$("#rational_response_text").fadeIn(200);

					// hide new_suggestions and more_help_reframe_personalized

					$("#new_suggestions").hide();
					$("#more_help_reframe_personalized").hide();

					// highlight reframe-edit-div with animation


					// reset #more_help_reframe which is a select
					$("#more_help_reframe").val('');
					$("#more_help_reframe").selectpicker("destroy");
					$("#more_help_reframe").selectpicker("render");

					$("#continue_help").fadeIn(100);

					// change to button to btn-success and text to tick + copied. Do it with an animation
					$(this).removeClass('btn-light');
					$(this).addClass('btn-success');
					$(this).html('<i class="fas fa-check"></i> updated');
					$(this).prop('disabled', true);

					// RESIZE textarea

					var textarea = document.querySelector('#rational_response_text');
					resizeTextArea(textarea, userDefinedHeight);

					$.ajax({
						url: "{% url 'diy_tool:save_url_clicks' %}",
						type: "GET",
						dataType: "json",
						data: {
							thought_record_id: thought_record_id,
							url_text: "replaced_with_the_reframe -- " + $(this).val(),
							},
						success : function(data) {
							if(debug) console.log('saved url click');
						},
						error : function(xhr, errmsg, err) {
							if(debug) console.log('not saved url click');
						}
					});


				});

				function more_help_rational_response_request_1_ajax(situation, thought, curr_cd, original_reframe, prompt_type, more_context){

					curr_url = '{% url "diy_tool:get_more_help_2" %}';

					return $.ajax({
						type: "GET",
						url: curr_url, 
						data: {"thought_record_id": thought_record_id, "situation": situation, "thought": thought, "cognitive_distortion_category": curr_cd, "original_reframe": original_reframe, "prompt_type": prompt_type, "more_context": more_context, 'theme': curr_theme},
						dataType: "json",
						success: function(response){
							// reframed_thought_1 = response['reframed_thought'];
							// prompt_type_1 = response['prompt_type'];
						}, error : function(xhr, errmsg, err) {
							if(debug) console.log('request_failed', errmsg);
						}
					});

					}

				function more_help_rational_response_request_2_ajax(situation, thought, curr_cd, original_reframe, prompt_type, more_context){
					curr_url = '{% url "diy_tool:get_more_help_1" %}';
					return $.ajax({
						type: "GET",
						url: curr_url, 
						data: {"thought_record_id": thought_record_id, "situation": situation, "thought": thought, "cognitive_distortion_category": curr_cd, "original_reframe": original_reframe, "prompt_type": prompt_type, "more_context": more_context, 'theme': curr_theme},
						dataType: "json",
						success: function(response){
							// reframed_thought_1 = response['reframed_thought'];
							// prompt_type_1 = response['prompt_type'];
						}, error : function(xhr, errmsg, err) {
							if(debug) console.log('request_failed', errmsg);
						}
					});

					}



				function more_help_rational_response(situation, thought, cognitive_distortion_category_li, original_reframe, prompt_type, more_context){

					var curr_cd = cognitive_distortion_category_li[0];

					$('#new_suggestions').fadeIn(300);

					$("#new_suggestions").append('<span class="text-muted fs-5-5" style="color: #144b5e; font-weight: 500;">Here are a few other reframes you may consider. You can use them to edit or update your initial reframe.</span>');

					// Add 2 skeleton divs

					$("#new_suggestions").append('<div id="skeleton_rr_div_more_help_1" class="shadow-sm bg-body-tertiary mt-3 mx-3 skeleton skeleton-text skeleton-text__body py-4">' +
					'</div>');

					$("#new_suggestions").append('<div id="skeleton_rr_div_more_help_2" class="shadow-sm bg-body-tertiary mt-3 mx-3 skeleton skeleton-text skeleton-text__body py-4">' +
					'<br/><br/>' +
					'</div>');


					$.when(more_help_rational_response_request_1_ajax(situation, thought, curr_cd, original_reframe, prompt_type, more_context), more_help_rational_response_request_2_ajax(situation, thought, curr_cd, original_reframe, prompt_type, more_context),).done(function(a1,a2){

						reframed_thought_1 = a1[0]['reframed_thought'];
						prompt_type_1 = a1[0]['prompt_type'];

						reframed_thought_2 = a2[0]['reframed_thought'];
						prompt_type_2 = a2[0]['prompt_type'];

						$.ajax({
							type: "GET",
							url: "{% url 'diy_tool:combine_reframe_thoughts_more_help' %}", 
							data: {"thought_record_id": thought_record_id, "original_reframe": original_reframe, "reframed_thought_1": reframed_thought_1, "reframed_thought_2": reframed_thought_2, "prompt_type_1": prompt_type_1, "prompt_type_2": prompt_type_2, "more_context": more_context},
							// data: {"thought_record_id": thought_record_id, "cognitive_distortion_category": cognitive_distortion_category, "reframed_thought_1": reframed_thought_1, "prompt_type_1": prompt_type_1,},
							dataType: "json",
							success: function(response){

								reframes_generated_id = response['reframes_generated_id'];
								out = response['out'];

								if(debug) console.log(out);

								$("#skeleton_rr_div_more_help_1").remove();
								$("#skeleton_rr_div_more_help_2").remove();								
									
									$('#new_suggestions').fadeIn(300, function(){
										
										// $("#rational_response").append('<p class="fs-5 mt-5 mb-4" style="color: #055596;"><b>Here is one reframe you may consider. Click it to start working on it or add your own reframe.</b></p>');

										$("#new_suggestions").append('<div class="row" id = "reframe_list_more_help">');

										for(var i=0; i < out.length; i++)
										{
											if(debug) console.log(out[i].length);
												$("#new_suggestions").append('<div class="shadow-sm bg-body-tertiary mt-4 pt-3 pb-3 px-4 mx-3" style="border: 1px solid #ced4da;border-radius: 5px">' +
																			'<span style="font-size: 1.7em; color: #144b5e;" class="pb-1" id="#more_help_rational_response_'+ i + '"><i>' + out[i] + '</i></span>' +
																			'<div class="mt-2">' +
																				// Add a small copy button and an update button
																				'<button type="button" class="btn btn-sm btn-light me-3 mt-1 copy_reframe" id="copy_more_help_rational_response_'+ i + '" value="'+ out[i] + '"><i class="far fa-copy"></i> copy this reframe</button>' +  
																				'<button type="button" class="btn btn-sm btn-light me-3 mt-1 add_reframe" id="add_more_help_rational_response_'+ i + '" value="'+ out[i] + '"><i class="fas fa-plus"></i> add this to my reframe</button>' +
																				'<button type="button" class="btn btn-sm btn-light mt-1 update_reframe" id="update_more_help_rational_response_'+ i + '" value="'+ out[i] + '"><i class="fas fa-sync"></i> replace my reframe with this one</button>'+																				
																				'</div>' +
																				'</div>');
										}
										
										$("#new_suggestions").append('</div>');

									}
									
									);
							},
							error : function(xhr, errmsg, err) {
								if(debug) console.log('request_failed', errmsg);
							}

						});

					});


					};



                // Form Animation
                let step = document.getElementsByClassName('step');
                let prevBtn = document.getElementById('prev-btn');
                let nextBtn = document.getElementById('next-btn');
                let submitBtn = document.getElementById('submit-btn');
                let form = document.getElementsByTagName('form')[0];
                let bodyElement = document.querySelector('body');
                let succcessDiv = document.getElementById('success');
                let start_over = document.getElementById('start_over');
				let start_over_mobile = document.getElementById('start_over_mobile');
                let try_again = document.getElementById('try_again');
                

                form.onsubmit = () => {
                    return false
                }
                let current_step = 0;
				let previous_step = 0;
                let stepCount = 10;
                step[current_step].classList.add('d-block');
                if (current_step == 0) {
                    prevBtn.classList.add('d-none');
                    submitBtn.classList.add('d-none');
                    nextBtn.classList.add('d-inline-block');
                }

                $(nextBtn).html('Start');

				if(win.width() <= mobile_width){
					$("#start_over_div_mobile").hide();
				}


				function resizeTextArea(textarea, userDefinedHeight = 0) {
				const { style, value } = textarea;

				// The 4 corresponds to the 2 2px borders (top and bottom):
				style.height = style.minHeight = 'auto';
				style.minHeight = `${ Math.min(textarea.scrollHeight + 4, parseInt(textarea.style.maxHeight)) }px`;
				style.height = `${ Math.max(textarea.scrollHeight + 4, userDefinedHeight) }px`;
				}


				let userDefinedHeight = 0;

				// situation

				document.getElementById('situation').addEventListener('input', () => {
					const textarea = document.getElementById('situation');
					resizeTextArea(textarea, userDefinedHeight);
				});

				document.getElementById('situation').addEventListener('mouseup', () => {
					const textarea = document.getElementById('situation');
					const { height, minHeight } = textarea.style;

					// Do not shrink beyond user-defined values (if they expand it manually),
					// but go back to auto-resizing if they shrink it back to the content size:
					userDefinedHeight = height === minHeight ? 0 : parseInt(height, 10);
				});

				// thought

				document.getElementById('thought').addEventListener('input', () => {
					const textarea = document.getElementById('thought');
					resizeTextArea(textarea, userDefinedHeight);
				});

				document.getElementById('thought').addEventListener('mouseup', () => {
					const textarea = document.getElementById('thought');
					const { height, minHeight } = textarea.style;

					// Do not shrink beyond user-defined values (if they expand it manually),
					// but go back to auto-resizing if they shrink it back to the content size:
					userDefinedHeight = height === minHeight ? 0 : parseInt(height, 10);
				});

				document.getElementById('rational_response_text').addEventListener('input', () => {
					const textarea = document.getElementById('rational_response_text');
					resizeTextArea(textarea, userDefinedHeight);
				});

				document.getElementById('rational_response_text').addEventListener('mouseup', () => {
					const textarea = document.getElementById('rational_response_text');
					const { height, minHeight } = textarea.style;

					// Do not shrink beyond user-defined values (if they expand it manually),
					// but go back to auto-resizing if they shrink it back to the content size:
					userDefinedHeight = height === minHeight ? 0 : parseInt(height, 10);
				});




				





				$('div').on('click', '#finish_reframing', function(event){
					event.stopPropagation();
					event.stopImmediatePropagation();

					if(nextWorking) return false;

                    nextWorking = true;

					if(current_step == 7)
                    {
                        if($("#rational_response_text").val().trim() == ""){
                            $("#empty_improved_reframe").fadeIn(200);

							$.ajax({
								url: "{% url 'diy_tool:save_next_check_error' %}",
								type: "GET",
								dataType: "json",
								data: {
									thought_record_id: thought_record_id, 
									step_number_from: 6,
									error_type: 'improved reframe empty',
									},
								success : function(json) {
									if(debug) console.log('next check error saved');
								},
								error : function(xhr, errmsg, err) {
									if(debug) console.log('next check error not saved');
								}
							});

                            nextWorking = false;
                            return;
                        }
                    }

					$("#qbox-container-inner").fadeOut(300, function(){

							// if(win.width() >= mobile_width){

							//     $("#start_over_div").hide();
							// }

							$("#qbox-container-inner").hide();

							if(current_step == 0){
								if($("#consent").is(':checked')){
									current_step = 2;
									previous_step = 0;
								}
								else{
									current_step = 1;
									previous_step = 0;
								}
							}

							else{
								current_step++;
								previous_step = current_step - 1;
							}

							while(skip_step_li.includes(current_step)){
								current_step++;							
							}

							if(debug) console.log('current_step: ' + current_step);
							if(debug) console.log('previous_step: ' + previous_step);


							$.ajax({
								url: "{% url 'diy_tool:save_steps_logs' %}",
								type: "GET",
								dataType: "json",
								data: {
									thought_record_id: thought_record_id,
									step_number_from: previous_step,
									step_number_to: current_step,
									},
								success : function(json) {
									if(debug) console.log('steps_logs saved');
								},
								error : function(xhr, errmsg, err) {
									if(debug) console.log('steps_logs not saved');
								}
							});

							prevBtn.classList.remove('d-none');
                            prevBtn.classList.add('d-inline-block');    

                            step[previous_step].classList.remove('d-block');
                            step[previous_step].classList.add('d-none');
                            
                            step[current_step].classList.remove('d-none');
                            step[current_step].classList.add('d-block');

                            if(current_step >= 1){
                                
                                // $("#qbox-div").removeClass('col-lg-7');
                                // $("#qbox-div").addClass('col-lg-9');

                                $(nextBtn).html('Next');
                            }

							if(previous_step == 7)
							{
								var rational_response_text = $('#rational_response_text').val();

								// Save Reframe Final

								$.ajax({
									url: "{% url 'diy_tool:save_reframe_final' %}",
									type: "GET",
									dataType: "json",
									data: {
										thought_record_id: thought_record_id, 
										reframe_final: rational_response_text,
										},
									success : function(json) {
										if(debug) console.log('Reframe final saved');
									},
									error : function(xhr, errmsg, err) {
										if(debug) console.log('Reframe final not saved');
									}
								});

								// if(win.width() >= mobile_width){
									// createBubble(rational_response_text, 'Reframe');
									animationCounter = 1;
								// }



								curr_reframe = rational_response_text;
								if(curr_reframe.length > 100){
									curr_reframe = curr_reframe.substring(0, 100) + '...';
								}

								// typeName(curr_reframe, 0, "reframe-caption");

								$("#reframe-caption").text(curr_reframe);
								
								$("#side-reframe").removeClass('side-step-active');
								$("#side-reframe").addClass('side-step-done');
								$("#side-reframe").next().addClass('side-step-active');


								rational_response_final = rational_response_text;
                                $("#rational_response_final").text(rational_response_final);
								$("#rational_response_final_evaluate").text(rational_response_final);


								gtag('event', 'ai_complete', {
									'custom_paremeter_name': 'something'
								});

								if(debug) console.log('gtag logged');
							}


                            if(current_step == 8)
                            {
                                var title_height_str = $("#chatbot-list").css('height');
                                var title_height = parseInt(title_height_str.substring(0,title_height_str.length - 2)) + 110;
                                if(debug) console.log(title_height_str);

                                $('#qbox-container').css('min-height', Math.max(title_height, 700) + 'px');
                            }


							$("#qbox-container-inner").fadeIn(300, function(){
								nextWorking = false;
							});

					});


				});



				var start_over_working = false;				

                start_over.addEventListener('click', (event) => {

					if(start_over_working) return false;

                    start_over_working = true;

                    previous_step = current_step;
                    current_step = 0;

                    $("#qbox-container-inner").fadeOut(300, function(){

						$.ajax({
							url: "{% url 'diy_tool:save_start_over' %}",
							type: "GET",
							dataType: "json",
							data: {
								thought_record_id: thought_record_id,
								step_number_from: previous_step,
								skip_step: skip_step,
								remove_negative_feeling: remove_negative_feeling,
								prompt_to_use: prompt_to_use,
								refresh_btn: refresh_btn,
								more_suggestions_btn: more_suggestions_btn,
								descriptive_thought_Q: descriptive_thought_Q,
								A_A: A_A,
								multiple_cognitive_distortions: multiple_cognitive_distortions,
								emotion_questions: emotion_questions,
								personalize: personalize,
								readable: readable,
								psychoeducation: psychoeducation,
								ai: ai,
								include_emotions: include_emotions,
								},
							success : function(data) {
								if(debug) console.log('new thought id: ' + data['new_thought_record_id']);
								thought_record_id = data['new_thought_record_id'];
							},
							error : function(xhr, errmsg, err) {
								if(debug) console.log('not start over');
							}
						});

						if(debug) console.log('new thought id set: ' + thought_record_id);

                        // $("#start_over_div").hide();

                        $('#qbox-container').css('min-height', '420px');

                        prevBtn.classList.remove('d-inline-block');
                        prevBtn.classList.add('d-none');

                        submitBtn.classList.remove('d-inline-block');
                        submitBtn.classList.add('d-none');

                        nextBtn.classList.remove('d-none');
                        nextBtn.classList.add('d-inline-block');

                        $(nextBtn).html('Start');
                        $("#chatbot-container-div").animate({width:'toggle'},250);

						if(win.width() <= mobile_width){
							$("#start_over_div_mobile").fadeOut(300);
						}

                        // $(".chatlist").find("li:not(:first-child)").remove();

                        step[previous_step].classList.remove('d-block');
                        step[previous_step].classList.add('d-none');
                        
                        step[current_step].classList.remove('d-none');
                        step[current_step].classList.add('d-block');

                        if(previous_step == 2){
                            $("#other_thoughts").addClass('d-none');
                            $("#other_thoughts").removeClass('d-block');
                        }

                        $("#empty_consent").hide();
                        // $('#consent').prop('checked', false);

                        $("#empty_thought").hide();
                        $("#thought").val('');
                        $("#empty_situation").hide();
                        $("#situation").val('');
                        $("#empty_cognitive_distortion").hide();
                        $("#empty_reframe").hide();
                        $("#empty_improved_reframe").hide();
                        $("#empty_outcome").hide();
                        $("#cognitive_distortions").html('');
						$("#cognitive_distortions_results").html('');

                        $("#rational_response").html('');
						$("#rational_response_results").html('');

						$("input[name='believable']").prop('checked', false);
						$("input[name='stickiness']").prop('checked', false);
						$("input[name='helpfulness']").prop('checked', false);
						$("input[name='learnability']").prop('checked', false);

						$("input[name='beliefVal']").prop('checked', false);
						$("input[name='emotionStrengthVal']").prop('checked', false);

						$("input[name='beliefValAfter1']").prop('checked', false);
						$("input[name='beliefValAfter2']").prop('checked', false);
						$("input[name='emotionStrengthValAfter1']").prop('checked', false);
						$("input[name='emotionStrengthValAfter2']").prop('checked', false);

						if(extra_q == 1){
							$("input[name='recommendation']").prop('checked', false);
						}


						$(".side-step-active").removeClass('side-step-active');
						$(".side-step-done").removeClass('side-step-done');

						$("#thought-caption").text('');
						$("#emotion-caption").text('');
						$("#situation-caption").text('');
						$("#thinking-trap-caption").text('');
						$("#reframe-caption").text('');

						$("#side-thought").addClass('side-step-active');

						// $("#age_range").val('default');
						// $("#gender").val('default');
						// $("#race").val('default');
						// // $("#income").val('default');
						// $("#education").val('default');
						// $("#population").val('default');
						// $("#problems").val('default');
						// $("#treatment").val('default');
						// $("#prior_experience").val('default');

						// $("#age_range").selectpicker("refresh");
						// $("#gender").selectpicker("refresh");
						// $("#race").selectpicker("refresh");
						// // $("#income").selectpicker("refresh");
						// $("#education").selectpicker("refresh");
						// $("#population").selectpicker("refresh");
						// $("#problems").selectpicker("refresh");
						// $("#treatment").selectpicker("refresh");
						// $("#prior_experience").selectpicker("refresh");


                        if(win.width() >= mobile_width){
                            $('#full-page-container')[0].scrollIntoView({behavior: "auto",});
                        }

                        else{
                            $('#full-page-container')[0].scrollIntoView({behavior: "auto",});
                        }

                        $("#qbox-container-inner").fadeIn(300, function(){

							start_over_working = false;
                        });

                    });

                });

				var start_over_mobile_working = false;

				start_over_mobile.addEventListener('click', (event) => {

					if(start_over_mobile_working) return false;

					start_over_mobile_working = true;

					previous_step = current_step;
					current_step = 0;

					$("#qbox-container-inner").fadeOut(300, function(){

						$.ajax({
							url: "{% url 'diy_tool:save_start_over' %}",
							type: "GET",
							dataType: "json",
							data: {
								thought_record_id: thought_record_id,
								step_number_from: previous_step,
								skip_step: skip_step,
								remove_negative_feeling: remove_negative_feeling,
								prompt_to_use: prompt_to_use,
								refresh_btn: refresh_btn,
								more_suggestions_btn: more_suggestions_btn,
								descriptive_thought_Q: descriptive_thought_Q,
								A_A: A_A,
								multiple_cognitive_distortions: multiple_cognitive_distortions,
								emotion_questions: emotion_questions,
								personalize: personalize,
								readable: readable,
								psychoeducation: psychoeducation,
								ai: ai,
								include_emotions: include_emotions,
								},
							success : function(data) {
								if(debug) console.log('new thought id: ' + data['new_thought_record_id']);
								thought_record_id = data['new_thought_record_id'];
							},
							error : function(xhr, errmsg, err) {
								if(debug) console.log('not start over');
							}
						});

						if(debug) console.log('new thought id set: ' + thought_record_id);

						// $("#start_over_div").hide();

						$('#qbox-container').css('min-height', '420px');

						prevBtn.classList.remove('d-inline-block');
						prevBtn.classList.add('d-none');

						submitBtn.classList.remove('d-inline-block');
						submitBtn.classList.add('d-none');

						nextBtn.classList.remove('d-none');
						nextBtn.classList.add('d-inline-block');

						$(nextBtn).html('Start');
						$("#chatbot-container-div").animate({width:'toggle'},250);

						if(win.width() <= mobile_width){
							$("#start_over_div_mobile").fadeOut(300);
						}

						// $(".chatlist").find("li:not(:first-child)").remove();

						step[previous_step].classList.remove('d-block');
						step[previous_step].classList.add('d-none');
						
						step[current_step].classList.remove('d-none');
						step[current_step].classList.add('d-block');

						if(previous_step == 2){
							$("#other_thoughts").addClass('d-none');
							$("#other_thoughts").removeClass('d-block');
						}

						$("#empty_consent").hide();
						// $('#consent').prop('checked', false);

						$("#empty_thought").hide();
						$("#thought").val('');
						$("#empty_situation").hide();
						$("#situation").val('');
						$("#empty_cognitive_distortion").hide();
						$("#empty_reframe").hide();
						$("#empty_improved_reframe").hide();
						$("#empty_outcome").hide();
						$("#cognitive_distortions").html('');
						$("#cognitive_distortions_results").html('');

						$("#rational_response").html('');
						$("#rational_response_results").html('');

						$("input[name='believable']").prop('checked', false);
						$("input[name='stickiness']").prop('checked', false);
						$("input[name='helpfulness']").prop('checked', false);
						$("input[name='learnability']").prop('checked', false);

						$("input[name='beliefVal']").prop('checked', false);
						$("input[name='emotionStrengthVal']").prop('checked', false);

						$("input[name='beliefValAfter1']").prop('checked', false);
						$("input[name='beliefValAfter2']").prop('checked', false);
						$("input[name='emotionStrengthValAfter1']").prop('checked', false);
						$("input[name='emotionStrengthValAfter2']").prop('checked', false);

						if(extra_q == 1){
							$("input[name='recommendation']").prop('checked', false);
						}


						$(".side-step-active").removeClass('side-step-active');
						$(".side-step-done").removeClass('side-step-done');

						$("#thought-caption").text('');
						$("#emotion-caption").text('');
						$("#situation-caption").text('');
						$("#thinking-trap-caption").text('');
						$("#reframe-caption").text('');

						$("#side-thought").addClass('side-step-active');

						// $("#age_range").val('default');
						// $("#gender").val('default');
						// $("#race").val('default');
						// // $("#income").val('default');
						// $("#education").val('default');
						// $("#population").val('default');
						// $("#problems").val('default');
						// $("#treatment").val('default');
						// $("#prior_experience").val('default');

						// $("#age_range").selectpicker("refresh");
						// $("#gender").selectpicker("refresh");
						// $("#race").selectpicker("refresh");
						// // $("#income").selectpicker("refresh");
						// $("#education").selectpicker("refresh");
						// $("#population").selectpicker("refresh");
						// $("#problems").selectpicker("refresh");
						// $("#treatment").selectpicker("refresh");
						// $("#prior_experience").selectpicker("refresh");


						if(win.width() >= mobile_width){
							$('#full-page-container')[0].scrollIntoView({behavior: "auto",});
						}

						else{
							$('#full-page-container')[0].scrollIntoView({behavior: "auto",});
						}

						$("#qbox-container-inner").fadeIn(300, function(){

							start_over_mobile_working = false;
						});

					});

					});

				var try_again_working = false;

                try_again.addEventListener('click', (event) => {

					if(try_again_working) return false;

                    try_again_working = true;

                    previous_step = current_step;
                    current_step = 0;

                    $("#qbox-container-inner").fadeOut(300, function(){

						$.ajax({
							url: "{% url 'diy_tool:save_start_over' %}",
							type: "GET",
							dataType: "json",
							data: {
								thought_record_id: thought_record_id, 
								step_number_from: previous_step,
								skip_step: skip_step,
								remove_negative_feeling: remove_negative_feeling,
								prompt_to_use: prompt_to_use,
								refresh_btn: refresh_btn,
								more_suggestions_btn: more_suggestions_btn,
								descriptive_thought_Q: descriptive_thought_Q,
								A_A: A_A,
								multiple_cognitive_distortions: multiple_cognitive_distortions,
								emotion_questions: emotion_questions,
								personalize: personalize,
								readable: readable,
								psychoeducation: psychoeducation,
								ai: ai,
								include_emotions: include_emotions,
								},
							success : function(data) {
								if(debug) console.log('new thought id: ' + data['new_thought_record_id']);
								thought_record_id = data['new_thought_record_id'];
							},
							error : function(xhr, errmsg, err) {
								if(debug) console.log('not try again');
							}
						});

						if(debug) console.log('new thought id set: ' + thought_record_id);

                        // $("#start_over_div").hide();

                        $('#qbox-container').css('min-height', '420px');

                        prevBtn.classList.remove('d-inline-block');
                        prevBtn.classList.add('d-none');

                        submitBtn.classList.remove('d-inline-block');
                        submitBtn.classList.add('d-none');

                        nextBtn.classList.remove('d-none');
                        nextBtn.classList.add('d-inline-block');

                        $(nextBtn).html('Start');

						if(win.width() <= mobile_width){
							$("#start_over_div_mobile").fadeOut(300);
						}


                        // $("#chatbot-container-div").animate({width:'toggle'},250);

                        // $(".chatlist").find("li:not(:first-child)").remove();

                        step[previous_step].classList.remove('d-block');
                        step[previous_step].classList.add('d-none');
                        
                        step[current_step].classList.remove('d-none');
                        step[current_step].classList.add('d-block');

                        if(previous_step == 2){
                            $("#other_thoughts").addClass('d-none');
                            $("#other_thoughts").removeClass('d-block');
                        }
                        
                        $("#empty_consent").hide();
                        // $('#consent').prop('checked', false);

                        $("#empty_thought").hide();
                        $("#thought").val('');
                        $("#empty_situation").hide();
                        $("#situation").val('');
                        $("#empty_cognitive_distortion").hide();
                        $("#empty_reframe").hide();
                        $("#empty_improved_reframe").hide();
                        $("#empty_outcome").hide();
                        $("#cognitive_distortions").html('');
						$("#cognitive_distortions_results").html('');

                        $("#rational_response").html('');
						$("#rational_response_results").html('');

						$("input[name='believable']").prop('checked', false);
						$("input[name='stickiness']").prop('checked', false);
						$("input[name='helpfulness']").prop('checked', false);
						$("input[name='learnability']").prop('checked', false);

						if(extra_q == 1){
							$("input[name='recommendation']").prop('checked', false);
						}

						$(".side-step-active").removeClass('side-step-active');
						$(".side-step-done").removeClass('side-step-done');

						$("#thought-caption").text('');
						$("#emotion-caption").text('');
						$("#situation-caption").text('');
						$("#thinking-trap-caption").text('');
						$("#reframe-caption").text('');

						$("#side-thought").addClass('side-step-active');

						// $("#gender").val('default');
						// $("#race").val('default');
						// // $("#income").val('default');
						// $("#education").val('default');
						// $("#population").val('default');
						// $("#problems").val('default');
						// $("#treatment").val('default');
						// $("#prior_experience").val('default');

						// $("#age_range").selectpicker("refresh");
						// $("#gender").selectpicker("refresh");
						// $("#race").selectpicker("refresh");
						// // $("#income").selectpicker("refresh");
						// $("#education").selectpicker("refresh");
						// $("#population").selectpicker("refresh");
						// $("#problems").selectpicker("refresh");
						// $("#treatment").selectpicker("refresh");
						// $("#prior_experience").selectpicker("refresh");

                        if(win.width() >= mobile_width){
                            $('#full-page-container')[0].scrollIntoView({behavior: "auto",});
                        }

                        else{
                            $('#full-page-container')[0].scrollIntoView({behavior: "auto",});
                        }

                        $("#qbox-container-inner").fadeIn(300, function(){

							try_again_working = false;
                        });

                    });

                });



                var nextWorking = false;

                nextBtn.addEventListener('click', (event) => {
                    
                    if(nextWorking) return false;

                    nextWorking = true;


                    if(current_step == 1)
                    {
                        if(!$("#consent").is(':checked')){
                            $("#empty_consent").fadeIn(200);
							
							$.ajax({
								url: "{% url 'diy_tool:save_next_check_error' %}",
								type: "GET",
								dataType: "json",
								data: {
									thought_record_id: thought_record_id, 
									step_number_from: 1,
									error_type: 'consent box not checked',
									},
								success : function(json) {
									if(debug) console.log('next check error saved');
								},
								error : function(xhr, errmsg, err) {
									if(debug) console.log('next check error not saved');
								}
							});

                            nextWorking = false;
                            return;
                        }
                    }

                    else if(current_step == 2)
                    {
                        if($("#thought").val().trim() == ""){
                            $("#empty_thought").html('<mark style="background-color:#fff3e0;">Please type your thought in the textbox above.</mark></p>');
                            $("#empty_thought").fadeIn(200);

							$.ajax({
								url: "{% url 'diy_tool:save_next_check_error' %}",
								type: "GET",
								dataType: "json",
								data: {
									thought_record_id: thought_record_id, 
									step_number_from: 2,
									error_type: 'thought empty',
									},
								success : function(json) {
									if(debug) console.log('next check error saved');
								},
								error : function(xhr, errmsg, err) {
									if(debug) console.log('next check error not saved');
								}
							});

                            nextWorking = false;
                            return;
                        }

                        else if($('#thought').val().trim().split(' ').length <= 1){
                            $("#empty_thought").html('<mark style="background-color:#fff3e0;">Please type at least one full sentence to continue.</mark></p>');
                            $("#empty_thought").fadeIn(200);

							$.ajax({
								url: "{% url 'diy_tool:save_next_check_error' %}",
								type: "GET",
								dataType: "json",
								data: {
									thought_record_id: thought_record_id, 
									step_number_from: 2,
									error_type: 'thought single word',
									},
								success : function(json) {
									if(debug) console.log('next check error saved');
								},
								error : function(xhr, errmsg, err) {
									if(debug) console.log('next check error not saved');
								}
							});

                            nextWorking = false;
                            return;
                        }
                    }

                    else if(current_step == 4)
                    {
                        if($("#situation").val().trim() == ""){
                            $("#empty_situation").html('<mark style="background-color:#fff3e0;">Please type the situation in the textbox above.</mark></p>');
                            $("#empty_situation").fadeIn(200);

							$.ajax({
								url: "{% url 'diy_tool:save_next_check_error' %}",
								type: "GET",
								dataType: "json",
								data: {
									thought_record_id: thought_record_id, 
									step_number_from: 3,
									error_type: 'situation empty',
									},
								success : function(json) {
									if(debug) console.log('next check error saved');
								},
								error : function(xhr, errmsg, err) {
									if(debug) console.log('next check error not saved');
								}
							});

                            nextWorking = false;
                            return;
                        }

                        else if($('#situation').val().trim().split(' ').length <= 1){
                            $("#empty_situation").html('<mark style="background-color:#fff3e0;">Please type at least one full sentence to continue.</mark></p>');
                            $("#empty_situation").fadeIn(200);


							$.ajax({
								url: "{% url 'diy_tool:save_next_check_error' %}",
								type: "GET",
								dataType: "json",
								data: {
									thought_record_id: thought_record_id, 
									step_number_from: 3,
									error_type: 'situation single word',
									},
								success : function(json) {
									if(debug) console.log('next check error saved');
								},
								error : function(xhr, errmsg, err) {
									if(debug) console.log('next check error not saved');
								}
							});

                            nextWorking = false;
                            return;
                        }

                    }

                    else if(current_step == 5)
                    {
                        if(!($("input[name='cognitive_distortion_category']").is(':checked'))){
                            $("#empty_cognitive_distortion").fadeIn(200);

							$.ajax({
								url: "{% url 'diy_tool:save_next_check_error' %}",
								type: "GET",
								dataType: "json",
								data: {
									thought_record_id: thought_record_id, 
									step_number_from: 4,
									error_type: 'thinking trap not checked',
									},
								success : function(json) {
									if(debug) console.log('next check error saved');
								},
								error : function(xhr, errmsg, err) {
									if(debug) console.log('next check error not saved');
								}
							});

                            nextWorking = false;
                            return;
                        }
                    }

                    else if(current_step == 6)
                    {
                        if($("#rational_response_text_orig").val().trim() == ""){
                            $("#empty_reframe").fadeIn(200);

							$.ajax({
								url: "{% url 'diy_tool:save_next_check_error' %}",
								type: "GET",
								dataType: "json",
								data: {
									thought_record_id: thought_record_id, 
									step_number_from: 5,
									error_type: 'reframe not checked',
									},
								success : function(json) {
									if(debug) console.log('next check error saved');
								},
								error : function(xhr, errmsg, err) {
									if(debug) console.log('next check error not saved');
								}
							});

                            nextWorking = false;
                            return;
                        }

                        else{

                            rational_response = $("#rational_response_text_orig").val();

							// else{
							// 	nextBtn.classList.remove('d-inline-block');
                            // 	nextBtn.classList.add('d-none');
							// }
                        }
                    }


                    else if(current_step == 7)
                    {
                        if($("#rational_response_text").val().trim() == ""){
                            $("#empty_improved_reframe").fadeIn(200);

							$.ajax({
								url: "{% url 'diy_tool:save_next_check_error' %}",
								type: "GET",
								dataType: "json",
								data: {
									thought_record_id: thought_record_id, 
									step_number_from: 6,
									error_type: 'improved reframe empty',
									},
								success : function(json) {
									if(debug) console.log('next check error saved');
								},
								error : function(xhr, errmsg, err) {
									if(debug) console.log('next check error not saved');
								}
							});

                            nextWorking = false;
                            return;
                        }
                    }


                    else if(current_step == 8)
                    {

						if(extra_q == 1){

							if(!($("input[name='believable']").is(':checked') && $("input[name='stickiness']").is(':checked') && $("input[name='helpfulness']").is(':checked') && $("input[name='learnability']").is(':checked') && $("input[name='recommendation']").is(':checked') )){
								$("#empty_outcome").fadeIn(200);

								$.ajax({
									url: "{% url 'diy_tool:save_next_check_error' %}",
									type: "GET",
									dataType: "json",
									data: {
										thought_record_id: thought_record_id, 
										step_number_from: 6,
										error_type: 'outcome not fully filled',
										},
									success : function(json) {
										if(debug) console.log('next check error saved');
									},
									error : function(xhr, errmsg, err) {
										if(debug) console.log('next check error not saved');
									}
								});

								nextWorking = false;
								return;
							}
						}

						else{
							if(!($("input[name='believable']").is(':checked') && $("input[name='stickiness']").is(':checked') && $("input[name='helpfulness']").is(':checked') && $("input[name='learnability']").is(':checked'))){
								$("#empty_outcome").fadeIn(200);

								$.ajax({
									url: "{% url 'diy_tool:save_next_check_error' %}",
									type: "GET",
									dataType: "json",
									data: {
										thought_record_id: thought_record_id, 
										step_number_from: 6,
										error_type: 'outcome not fully filled',
										},
									success : function(json) {
										if(debug) console.log('next check error saved');
									},
									error : function(xhr, errmsg, err) {
										if(debug) console.log('next check error not saved');
									}
								});

								nextWorking = false;
								return;
							}
						}
                    }


					if(win.width() >= mobile_width){
						if(current_step != 0 && current_step != 2){
							$('#full-page-container')[0].scrollIntoView({behavior: "smooth",});
						}
					}

					else{
						$('#full-page-container')[0].scrollIntoView({behavior: "auto",});
					}


                    $("#qbox-container-inner").fadeOut(300, function(){

						// if(win.width() >= mobile_width){

	                    //     $("#start_over_div").hide();
						// }

                        $("#qbox-container-inner").hide();

						if(current_step == 0){
							if($("#consent").is(':checked')){
								current_step = 2;
								previous_step = 0;
							}
							else{
								current_step = 1;
								previous_step = 0;
							}
						}

						else{
							current_step++;
							previous_step = current_step - 1;
						}

						while(skip_step_li.includes(current_step)){
							current_step++;							
						}

						if(debug) console.log('current_step: ' + current_step);
						if(debug) console.log('previous_step: ' + previous_step);


                        $.ajax({
                            url: "{% url 'diy_tool:save_steps_logs' %}",
                            type: "GET",
                            dataType: "json",
                            data: {
                                thought_record_id: thought_record_id,
                                step_number_from: previous_step,
                                step_number_to: current_step,
                                },
                            success : function(json) {
                                if(debug) console.log('steps_logs saved');
                            },
                            error : function(xhr, errmsg, err) {
                                if(debug) console.log('steps_logs not saved');
                            }
                        });

                        
                        if ((current_step > 0) && (current_step <= stepCount)) {

                            prevBtn.classList.remove('d-none');
                            prevBtn.classList.add('d-inline-block');    

                            step[previous_step].classList.remove('d-block');
                            step[previous_step].classList.add('d-none');
                            
                            step[current_step].classList.remove('d-none');
                            step[current_step].classList.add('d-block');

                            if(current_step >= 1){
                                
                                // $("#qbox-div").removeClass('col-lg-7');
                                // $("#qbox-div").addClass('col-lg-9');

                                $(nextBtn).html('Next');
                            }


                            if(current_step == 2)
                            {
                                // $("#qbox-div").removeClass('col-lg-9');
                                // $("#qbox-div").addClass('col-lg-7');

								$.ajax({
                                    url: "{% url 'diy_tool:save_consent' %}",
                                    type: "GET",
                                    dataType: "json",
                                    data: {
                                        thought_record_id: thought_record_id, 
										user_id: '{{ user_id }}',
                                        },
                                    success : function(json) {
                                        if(debug) console.log('consent saved');
                                    },
                                    error : function(xhr, errmsg, err) {
                                        if(debug) console.log('consent not saved');
                                    }
                                });


								$("#chatbot-container-div").animate({width:'toggle'},250); //show("slide", { direction: "right" }, 1000);

								if(win.width() <= mobile_width){
									$("#start_over_div_mobile").fadeIn(300);
								}

                                $("#other_thoughts").removeClass('d-none');
                                $("#other_thoughts").addClass('d-block');
                                var title_height_str = $("#chatbot-list").css('height');
                                var title_height = parseInt(title_height_str.substring(0,title_height_str.length - 2)) + 110;
                                if(debug) console.log(title_height_str);
                                $('#qbox-container').css('min-height', Math.max(title_height, 420) + 'px');
                                
                            }

                            else{
                                $("#other_thoughts").addClass('d-none');
                                $("#other_thoughts").removeClass('d-block');
                            }

							if(previous_step == 2)
							{
								// Save thought

								$.ajax({
                                    url: "{% url 'diy_tool:save_thought' %}",
                                    type: "GET",
                                    dataType: "json",
                                    data: {
                                        thought_record_id: thought_record_id, 
                                        thought: $('#thought').val(),
                                        },
                                    success : function(data) {
										thought_id = data['thought_id'];
                                        if(debug) console.log('thought saved');

                                    },
                                    error : function(xhr, errmsg, err) {
                                        if(debug) console.log('thought not saved');
                                    }
                                });

                            
                                $("#empty_thought").hide();
                                // if(win.width() >= mobile_width){
                                    // createBubble($('#thought').val(), 'Thought');
                                    animationCounter = 1;
                                // }
								
								// Add first 30 chars of thought val to thought-caption with typing effect
								
								var curr_thought_val = $('#thought').val();
								if(curr_thought_val.length > 100){
									curr_thought_val = curr_thought_val.substring(0, 100) + '...';
								}
								// typeName(curr_thought_val, 0, "thought-caption");

								$("#thought-caption").text(curr_thought_val);
								
								$("#side-thought").removeClass('side-step-active');
								$("#side-thought").addClass('side-step-done');
								$("#side-thought").next().addClass('side-step-active');

								thought_final = $('#thought').val();
                                $("#thought_final").text(thought_final);
								$("#thought_final_evaluate").text(thought_final);

								$("#emotion_thought").html('<div class="row shadow-sm bg-body-tertiary ms-1" style="background-color: #fafafa; border-radius: 50px 50px 50px 0; padding: 30px 20px 10px 30px; margin-top: 15px; margin-bottom: 30px; color: #144b5e; font-weight: 500; ">' + 
								'<p class="fs-5" style="color: #144b5e;"><b>Thought</b>' +
								'<p class="fs-5-5 mb-2 text-muted"><i>' + thought_final + '</i></p>' + 
								'</div>');
	
							}

							if(previous_step == 3){

								// get value from the radio button "beliefVal"
								belief = $('input[name="beliefVal"]:checked').val();

								// get value of the emotion input field
								emotion = $('#emotion').val();

								// get value from the radio button "emotionStrengthVal"
								emotion_strength = $('input[name="emotionStrengthVal"]:checked').val();

								// if(debug) console.log("belief:", belief);
								// if(debug) console.log("emotion:", emotion);
								// if(debug) console.log("emotion_strength:", emotion_strength);

								// Save
								$.ajax({
									url: "{% url 'diy_tool:save_emotion' %}",
									type: "GET",
									dataType: "json",
									data: {
										thought_record_id: thought_record_id, 
										belief: belief,
										emotion: emotion,
										emotion_strength: emotion_strength,
										},
									success : function(json) {
										if(debug) console.log('emotion saved');
									},
									error : function(xhr, errmsg, err) {
										if(debug) console.log('emotion not saved');
									}
								});

								$("#emotion_final").text(emotion);
								$("#emotion_final_evaluate").text(emotion);
								
								$("#emotion-caption").text(emotion);

								$("#side-emotion").removeClass('side-step-active');
								$("#side-emotion").addClass('side-step-done');
								$("#side-emotion").next().addClass('side-step-active');

							}


                            if(current_step == 4)
                            {
                                var title_height_str = $("#chatbot-list").css('height');
                                var title_height = parseInt(title_height_str.substring(0,title_height_str.length - 2)) + 110;
                                if(debug) console.log(title_height_str);

                                $('#qbox-container').css('min-height', Math.max(title_height, 420) + 'px');
                                
                            }


							if(previous_step == 4)
							{
								// Save situation

                                $.ajax({
                                    url: "{% url 'diy_tool:save_situation' %}",
                                    type: "GET",
                                    dataType: "json",
                                    data: {
                                        thought_record_id: thought_record_id, 
                                        situation: $('#situation').val(),
                                        },
                                    success : function(data) {
										situation_id = data['situation_id'];
                                        if(debug) console.log('situation saved ' + situation_id);
                                    },
                                    error : function(xhr, errmsg, err) {
                                        if(debug) console.log('situation not saved');
                                    }
                                });

                                $("#empty_situation").hide();

								 // if(win.width() >= mobile_width){
                                    // createBubble($('#situation').val(), 'Situation');
                                    animationCounter = 1;
                                // }
								
								var curr_situation_val = $('#situation').val();
								if(curr_situation_val.length > 100){
									curr_situation_val = curr_situation_val.substring(0, 100) + '...';
								}
								// typeName(curr_situation_val, 0, "situation-caption");

								$("#situation-caption").text(curr_situation_val);
								
								$("#side-situation").removeClass('side-step-active');
								$("#side-situation").addClass('side-step-done');
								$("#side-situation").next().addClass('side-step-active');



								situation_final = $('#situation').val();
                                $("#situation_final").text(situation_final);
								$("#situation_final_evaluate").text(situation_final);
							}

                            if(current_step == 5)
                            {
                                $("#cognitive_distortions").html('');
								$("#cognitive_distortions_results").html('');

                                // $("#cognitive_distortion_loading").show();

                                situation = $("#situation").val();
                                thought = $("#thought").val();

                                request_cognitive_distortion(situation, thought);
                                

                                var title_height_str = $("#chatbot-list").css('height');
                                var title_height = parseInt(title_height_str.substring(0,title_height_str.length - 2)) + 110;
                                if(debug) console.log(title_height_str);

                                $('#qbox-container').css('min-height', Math.max(title_height, 600) + 'px');

                            }
                            
							if(previous_step == 5)
							{
								$("#empty_cognitive_distortion").hide();

								situation = $("#situation").val();
                                thought = $("#thought").val();
								

								if(multiple_cognitive_distortions == 0){
	                                cognitive_distortion_category = $('input[name="cognitive_distortion_category"]:checked').val();
									cognitive_distortion_category_li.push(cognitive_distortion_category);
									distortion_definition_li.push(DISTORTION_DEFINITIONS[cognitive_distortion_category]);
								}
								else{
									$('input[name="cognitive_distortion_category"]:checked').each(function() 
									{
										cognitive_distortion_category_li.push($(this).val());
										distortion_definition_li.push(DISTORTION_DEFINITIONS[$(this).val()]);
									});
									cognitive_distortion_category = cognitive_distortion_category_li.join(';');

									
								}

                                
                                // Save Thinking Trap Selected

                                $.ajax({
                                    url: "{% url 'diy_tool:save_thinking_trap_selected' %}",
                                    type: "GET",
                                    dataType: "json",
                                    data: {
                                        thought_record_id: thought_record_id, 
                                        thinking_trap_selected: cognitive_distortion_category,
                                        },
                                    success : function(data) {
										thinking_trap_selected_id = data['thinking_trap_selected_id']
                                        if(debug) console.log('thinking trap saved');
                                    },
                                    error : function(xhr, errmsg, err) {
                                        if(debug) console.log('thinking trap not saved');
                                    }
                                });

								// if(win.width() >= mobile_width){
                                    // createBubble(cognitive_distortion_category, 'Thinking Trap');
                                    animationCounter = 1;
                                // }

								// typeName(cognitive_distortion_category, 0, "thinking-trap-caption");

								$("#thinking-trap-caption").text(cognitive_distortion_category);
								
								$("#side-thinking-trap").removeClass('side-step-active');
								$("#side-thinking-trap").addClass('side-step-done');
								$("#side-thinking-trap").next().addClass('side-step-active');


								thinking_trap_final = cognitive_distortion_category;
                                $("#thinking_trap_final").text(thinking_trap_final);
								$("#thinking_trap_final_evaluate").text(thinking_trap_final);

							}

                            if(current_step == 6)
                            {
                                $("#rational_response").html('');
								$("#rational_response_results").html('');

                                // if(cognitive_distortion_category == "Negative Feeling or Emotion")
                                // {

                                //     $('#rational_response').fadeIn(300, function(){

                                //         $("#rational_response").append('<p class="fs-3 mt-3 mb-4" style="color: #055596;"><b>Negative Feeling or Emotion: Explore Resources</b></p>');

                                //         $("#rational_response").append('<p class="fs-5-5 my-3">Here are a few resources which you may found helpful.</p>');

                                //         $("#rational_response").append('<p class="my-3"><a target="_blank" href="https://screening.mhanational.org/content/what-trauma/" class="resource_btn">What Is Trauma?</a></p>');

                                //         $("#rational_response").append('<p class="my-3"><a target="_blank" href="https://screening.mhanational.org/diy/" class="resource_btn">DIY Tools</a></p>');

                                //         $("#rational_response").append('<p class="my-3"><a target="_blank" href="https://screening.mhanational.org/screening-tools/" class="resource_btn">Take A Mental Health Test</a></p>');

                                //         $("#rational_response").append('<p class="my-3"><a target="_blank" href="https://screening.mhanational.org/get-help/" class="resource_btn">Get Help</a></p>');

                                //         nextBtn.classList.remove('d-inline-block');
                                //         nextBtn.classList.add('d-none');
                                //     });

                                //     var title_height_str = $("#chatbot-container").css('height');
                                //     var title_height = parseInt(title_height_str.substring(0,title_height_str.length - 2)) + 110;

                                //     $('#qbox-container').css('min-height', Math.max(title_height, 600) + 'px');
                                // }


								// var text = [ "This may take up to 30 seconds", "Hang tight", "Getting the right reframes..."];
								// var counter = 0;
								// var elem = document.getElementById("loading_text");
								// var inst = setInterval(change, 5000);

								// function change() {
								// 	elem.innerHTML = text[counter];
								// 	counter++;
								// 	if (counter >= text.length) {
								// 		// counter = 0;
								// 		clearInterval(inst); // uncomment this if you want to stop refreshing after one cycle
								// 	}
								// }


                                // $("#rational_response_loading").show();
                                
                                request_rational_response(situation, thought, cognitive_distortion_category_li, distortion_definition_li);

                                var title_height_str = $("#chatbot-container").css('height');
                                var title_height = parseInt(title_height_str.substring(0,title_height_str.length - 2)) + 110;
                                if(debug) console.log(title_height_str);
                                $('#qbox-container').css('min-height', Math.max(title_height, 700) + 'px');
                            }


							if(previous_step == 6)
							{
								rational_response = $("#rational_response_text_orig").val();


                                // Save Reframe Selected

                                $.ajax({
                                    url: "{% url 'diy_tool:save_reframe_selected' %}",
                                    type: "GET",
                                    dataType: "json",
                                    data: {
                                        thought_record_id: thought_record_id, 
                                        reframe_selected: rational_response,
                                        },
                                    success : function(data) {
										reframe_selected_id = data['reframe_selected_id'];
                                        if(debug) console.log('Reframe Selected saved');
                                    },
                                    error : function(xhr, errmsg, err) {
                                        if(debug) console.log('Reframe Selected not saved');
                                    }
                                });

                                $("#rational_response_text").val(rational_response);
								$("#rational_response_text").focus();

								// hide new_suggestions and more_help_reframe_personalized

								$("#new_suggestions").hide();
								$("#more_help_reframe_personalized").hide();

								// highlight reframe-edit-div with animation


								// reset #more_help_reframe which is a select
								$("#more_help_reframe").val('');
								$("#more_help_reframe").selectpicker("destroy");
								$("#more_help_reframe").selectpicker("render");

                                
                                // if(win.width() >= mobile_width){
                                //     createBubble(rational_response, 'Reframe');
                                //     animationCounter = 1;
                                // }
							}


                            if(current_step == 7)
                            {
								
								if(skip_step_li.includes(5)){
										$("#final_reframe_self").html('');

										$("#final_reframe_self").append('<p class="fs-5-5 my-3">We overcome thinking traps by coming up with new ways to think about the situation we are dealing with. This process is called <b>reframing</b>.</p>');

										// if(cognitive_distortion_category != "Negative Feeling or Emotion" && cognitive_distortion_category != "None of These Thinking Traps Seem Right to Me"){
										//     $("#rational_response").append('<p class="fs-5-5 my-3">Now that we think your thought may be falling into ' + cognitive_distortion_category.toLowerCase() + ', let\'s work together to overcome this thinking trap.</p>');
										// }


										$("#final_reframe_self").append('<p class="fs-5-5 mt-4 mb-2">What can you tell yourself to think about this situation in a <b>more positive, realistic, or helpful way?</b></p>');

										
										if(cognitive_distortion_category != "None of These Thinking Traps Seem Right to Me"){
											$("#final_reframe_self").append('<div class="row mt-4">' +
											'<div class="col-12">' +
											'<div class="card">' +
												'<div class="card-header fs-5-5" id="tips_heading">' +
													'<strong>Tips To Overcome ' + cognitive_distortion_category + ' </strong>' +
												'</div>' +
												'<div class="card-body">' +
													'<div class="row">' +
														'<p class="fs-5-5 my-1">' + DISTORTION_DEFINITIONS[cognitive_distortion_category] + '</p>' +
													'</div>' +
													'</div>' +
													'</div>' +
											'</div>' +
											'</div>');
										}


										// $("#rational_response").append('<p class="mb-3 text-muted">Tip: Consider what you would say to a friend who might be experiencing a similar thought and situation.</p>');

										// $("#rational_response").append('<p class="fs-5-5 my-3">Think about how you would tell yourself to avoid ' + cognitive_distortion_category.toLowerCase() + ' and look at the situation in a more realistic and balanced way.</p>');

										// $("#rational_response").append('<textarea  id="rational_response_text" name="rational_response_text" class="form-control" placeholder="Write a thought response here" rows=4 required></textarea>');

										$("#final_reframe_self").append('<p class="fs-5 mt-4 mb-4" style="color: #055596;"><b>Write your reframe in the textbox below:</b></p>');
								}

                                var title_height_str = $("#chatbot-list").css('height');
                                var title_height = parseInt(title_height_str.substring(0,title_height_str.length - 2)) + 110;

                                $('#qbox-container').css('min-height', Math.max(title_height, 700) + 'px');
                            }


							if(previous_step == 7)
							{
								var rational_response_text = $('#rational_response_text').val();

								// Save Reframe Final

								$.ajax({
									url: "{% url 'diy_tool:save_reframe_final' %}",
									type: "GET",
									dataType: "json",
									data: {
										thought_record_id: thought_record_id, 
										reframe_final: rational_response_text,
										},
									success : function(json) {
										if(debug) console.log('Reframe final saved');
									},
									error : function(xhr, errmsg, err) {
										if(debug) console.log('Reframe final not saved');
									}
								});

								// if(win.width() >= mobile_width){
									// createBubble(rational_response_text, 'Reframe');
									animationCounter = 1;
								// }



								curr_reframe = rational_response_text;
								if(curr_reframe.length > 100){
									curr_reframe = curr_reframe.substring(0, 100) + '...';
								}

								// typeName(curr_reframe, 0, "reframe-caption");

								$("#reframe-caption").text(curr_reframe);
								
								$("#side-reframe").removeClass('side-step-active');
								$("#side-reframe").addClass('side-step-done');
								$("#side-reframe").next().addClass('side-step-active');


								rational_response_final = rational_response_text;
                                $("#rational_response_final").text(rational_response_final);
								$("#rational_response_final_evaluate").text(rational_response_final);


								gtag('event', 'ai_complete', {
									'custom_paremeter_name': 'something'
								});

								if(debug) console.log('gtag logged');
							}


                            if(current_step == 8)
                            {
                                var title_height_str = $("#chatbot-list").css('height');
                                var title_height = parseInt(title_height_str.substring(0,title_height_str.length - 2)) + 110;
                                if(debug) console.log(title_height_str);

                                $('#qbox-container').css('min-height', Math.max(title_height, 700) + 'px');
                            }

                            if(previous_step == 8){
                                // Save Outcomes

								if(skip_step_li.includes(3)){
									$.ajax({
											url: "{% url 'diy_tool:save_outcome_questions' %}",
											type: "GET",
											dataType: "json",
											data: {
												thought_record_id: thought_record_id,
												believable: $('input[name="believable"]:checked').val(),
												stickiness: $('input[name="stickiness"]:checked').val(),
												helpfulness: $('input[name="helpfulness"]:checked').val(),
												learnability: $('input[name="learnability"]:checked').val(),
												},
											success : function(json) {
												if(debug) console.log('outcome questions saved');
											},
											error : function(xhr, errmsg, err) {
												if(debug) console.log('outcome questions not saved');
											}
										});
								}
								else{
									if(emotion_questions == 'first'){
										$.ajax({
											url: "{% url 'diy_tool:save_outcome_questions' %}",
											type: "GET",
											dataType: "json",
											data: {
												thought_record_id: thought_record_id,
												believable: $('input[name="believable"]:checked').val(),
												stickiness: $('input[name="stickiness"]:checked').val(),
												helpfulness: $('input[name="helpfulness"]:checked').val(),
												learnability: $('input[name="learnability"]:checked').val(),
												belief_1: $('input[name="beliefValAfter1"]:checked').val(),
												emotion_strength_1: $('input[name="emotionStrengthValAfter1"]:checked').val(),
												},
											success : function(json) {
												if(debug) console.log('outcome questions saved');
											},
											error : function(xhr, errmsg, err) {
												if(debug) console.log('outcome questions not saved');
											}
										});
									}
									else if(emotion_questions == 'second'){
										$.ajax({
											url: "{% url 'diy_tool:save_outcome_questions' %}",
											type: "GET",
											dataType: "json",
											data: {
												thought_record_id: thought_record_id,
												believable: $('input[name="believable"]:checked').val(),
												stickiness: $('input[name="stickiness"]:checked').val(),
												helpfulness: $('input[name="helpfulness"]:checked').val(),
												learnability: $('input[name="learnability"]:checked').val(),
												belief_2: $('input[name="beliefValAfter2"]:checked').val(),
												emotion_strength_2: $('input[name="emotionStrengthValAfter2"]:checked').val(),
												},
											success : function(json) {
												if(debug) console.log('outcome questions saved');
											},
											error : function(xhr, errmsg, err) {
												if(debug) console.log('outcome questions not saved');
											}
										});
									}
								}
                            }

                            if(previous_step == 9){

                                // Save Demographics

								if(debug) console.log($('#population').val().join(';'));

                                $.ajax({
                                    url: "{% url 'diy_tool:save_demographics' %}",
                                    type: "GET",
                                    dataType: "json",
                                    data: {
                                        thought_record_id: thought_record_id,
                                        age_range: $('#age_range').val(),
                                        gender: $('#gender').val(),
                                        race: $('#race').val(),
                                        education: $('#education').val(),
                                        population: $('#population').val().join(';'), // multiple
                                        problems: $('#problems').val().join(';'), // multiple
                                        treatment: $('#treatment').val(),
										prior_experience: $('#prior_experience').val(),
                                        },
                                    success : function(json) {
                                        if(debug) console.log('demographics saved');
                                    },
                                    error : function(xhr, errmsg, err) {
                                        if(debug) console.log('demographics not saved');
                                    }
                                });
                                
                            }

							if(current_step == 10)
							{
								$("#chatbot-container-div").animate({width:'toggle'},250);
								if(win.width() <= mobile_width){
									$("#start_over_div_mobile").fadeOut(300);
								}
							}


                            if(debug) console.log(step[previous_step].classList);
                            if(debug) console.log(step[previous_step]);  


                            // $('#chatbot-container-div').toggleClass('col-lg-0 col-lg-3');            


                            if (current_step == stepCount) {
                                // submitBtn.classList.remove('d-none');
                                // submitBtn.classList.add('d-inline-block');
                                nextBtn.classList.remove('d-inline-block');
                                nextBtn.classList.add('d-none');
                                prevBtn.classList.remove('d-inline-block');
                                prevBtn.classList.add('d-none');
                            }
                        } else {
                            if (current_step > stepCount) {
                                form.onsubmit = () => {
                                    nextWorking = false;
                                    return true
                                }
                            }
                        }

                        // $('html,body').animate({
                        //         scrollTop: $(".step").offset().top},
                        //     'slow');
                    

                        // if(current_step == 2)
                        // {
                        //     $("#start_over_div").fadeIn(300);
                        // }

                        // else
                        // {
						// 	if(win.width() >= mobile_width){
	                    //         $("#start_over_div").delay(300).fadeIn(300);
						// 	}
                        // }


                        $("#qbox-container-inner").fadeIn(300, function(){

							if(previous_step == 6){
								var textarea = document.getElementById("rational_response_text");
								resizeTextArea(textarea, userDefinedHeight);
							}

                            nextWorking = false;
                        });
                        
                    });
                });


                var prevWorking = false;


                prevBtn.addEventListener('click', (event) => {
                    if(prevWorking) return false;

                    prevWorking = true;

					// if(win.width() >= mobile_width){
	                //     $("#start_over_div").fadeOut(300);
					// }

					if(win.width() >= mobile_width){
						$('#full-page-container')[0].scrollIntoView({behavior: "smooth",});
					}

					else{
						$('#full-page-container')[0].scrollIntoView({behavior: "auto",});
					}
					

                    $("#qbox-container-inner").fadeOut(300, function(){
                        $("#qbox-container-inner").hide();
                        if (current_step > 0) {
                            

							if(current_step == 2){
								if($("#consent").is(':checked')){
									current_step = 0;
									previous_step = 2;
								}
								else{
									current_step = 1;
									previous_step = 2;
								}
							}

							else{
								current_step--;
                            	previous_step = current_step + 1;
							}

							while(skip_step_li.includes(current_step)){
								current_step--;
							}

                            $.ajax({
                                url: "{% url 'diy_tool:save_steps_logs' %}",
                                type: "GET",
                                dataType: "json",
                                data: {
                                    thought_record_id: thought_record_id,
                                    step_number_from: previous_step,
                                    step_number_to: current_step,
                                    },
                                success : function(json) {
                                    if(debug) console.log('steps_logs saved');
                                },
                                error : function(xhr, errmsg, err) {
                                    if(debug) console.log('steps_logs not saved');
                                }
                            });
                            

                            prevBtn.classList.add('d-none');
                            prevBtn.classList.add('d-inline-block');

                            step[previous_step].classList.remove('d-block');
                            step[previous_step].classList.add('d-none');
                            step[current_step].classList.remove('d-none');
                            step[current_step].classList.add('d-block');

                            // if (current_step == 2 || current_step == 3 || current_step == 4 || current_step == 6){
                            //     // $(".chatlist").find("li:last").remove();
                            // }

                            // if(current_step != 0 && current_step != 1){
							// 	if(win.width() >= mobile_width){
	                        //         $("#start_over_div").fadeIn(300);
							// 	}
                            // }

                            if(current_step == 0){
                                // $("#qbox-div").removeClass('col-lg-9');
                                // $("#qbox-div").addClass('col-lg-7');

                                $(nextBtn).html('Start');
                                $("#empty_thought").hide();
                            }

                            if(previous_step == 2){
                                // $("#qbox-div").removeClass('col-lg-7');
                                // $("#qbox-div").addClass('col-lg-9');

                                $("#empty_consent").hide();
                                // $('#consent').prop('checked', false);

                                $("#chatbot-container-div").animate({width:'toggle'},250);
                                $('#qbox-container').css('min-height', '420px');
                            }

                            if(current_step == 2)
                            {
                                $("#empty_situation").hide();
                                $("#other_thoughts").removeClass('d-none');
                                $("#other_thoughts").addClass('d-block');
								
								
								$("#thought-caption").text("");
								$("#side-thought").removeClass('side-step-done');
								$("#side-thought").addClass('side-step-active');
								$("#side-thought").next().removeClass('side-step-active');

                            }

                            else{
                                $("#other_thoughts").addClass('d-none');
                                $("#other_thoughts").removeClass('d-block');
                            }

							if(current_step == 3){
								$("#side-emotion").removeClass('side-step-done');
								$("#side-emotion").addClass('side-step-active');
								$("#side-emotion").next().removeClass('side-step-active');
							}

							if(current_step == 4){
								$("#situation-caption").text("");
								$("#side-situation").removeClass('side-step-done');
								$("#side-situation").addClass('side-step-active');
								$("#side-situation").next().removeClass('side-step-active');
							}

							if(current_step == 5){
								$("#thinking-trap-caption").text("");
								$("#side-thinking-trap").removeClass('side-step-done');
								$("#side-thinking-trap").addClass('side-step-active');
								$("#side-thinking-trap").next().removeClass('side-step-active');
							}

							if(current_step == 6){
								$("#reframe-caption").text("");

								// nextBtn.classList.add('d-inline-block');
                            	// nextBtn.classList.remove('d-none');
							}

							if(current_step == 7){
								$("#reframe-caption").text("");
								$("#side-reframe").removeClass('side-step-done');
								$("#side-reframe").addClass('side-step-active');
								$("#side-reframe").next().removeClass('side-step-active');
							}

                            if(previous_step == 5){
                                $("#empty_cognitive_distortion").hide();
                                var title_height_str = $("#chatbot-list").css('height');
                                if(debug) console.log(title_height_str);
                                var title_height = parseInt(title_height_str.substring(0,title_height_str.length - 2)) + 110;

                                $('#qbox-container').css('min-height', Math.max(title_height, 420) + 'px');
                                $("#cognitive_distortions").html('');
								$("#cognitive_distortions_results").html('');
								
                            }

                            if(previous_step == 6){
                                $("#empty_reframe").hide();
                                var title_height_str = $("#chatbot-list").css('height');
                                var title_height = parseInt(title_height_str.substring(0,title_height_str.length - 2)) + 110;
                                if(debug) console.log(title_height_str);
                                $('#qbox-container').css('min-height', Math.max(title_height, 600) + 'px');

                                $("#rational_response").html('');
								$("#rational_response_results").html('');
                            }

                            if(previous_step == 7){
                                $("#empty_improved_reframe").hide();
                            }

                            if (current_step < stepCount) {
                                submitBtn.classList.remove('d-inline-block');
                                submitBtn.classList.add('d-none');
                                nextBtn.classList.remove('d-none');
                                nextBtn.classList.add('d-inline-block');
                                prevBtn.classList.remove('d-none');
                                prevBtn.classList.add('d-inline-block');
                            }
                        }

                        if (current_step == 0) {
                            prevBtn.classList.remove('d-inline-block');
                            prevBtn.classList.add('d-none');
                        }

                        $("#qbox-container-inner").fadeIn(300, function(){
                            prevWorking = false;
                        });
                    });
                });


                // Chatbox

                var overview = document.querySelector('.chatbot__overview'),
                // chatList = document.querySelector('.chatlist'),
                botBubble = document.querySelectorAll('.bot__output'),
                animationCounter = 1,
                animationBubbleDelay = 200;

                var createBubble = function (input, heading) {
                    //create input bubble
                    var chatBubble = document.createElement('li');
                    chatBubble.classList.add('bot__output');
                    chatBubble.classList.add('bot__output--standard');

                    if (heading != null){
                        var chatHeading = document.createElement('div');
                        chatHeading.style.width =  '100%';

                        // chatHeading.classList.add('fs-5');
                        chatHeading.classList.add('pb-2');
                        
                        chatHeading.style.textAlign= 'left';
                        chatHeading.style.fontSize= '1.2em';
                        chatHeading.innerHTML = '<b>' + heading + '</b> <br />';

                        // chatHeading.appendChild(chatHeading)

                        chatBubble.appendChild(chatHeading);


                        var lineBreak = document.createElement('div');
                        lineBreak.classList.add('line-break');
                        chatBubble.appendChild(lineBreak);
                    }
                
                    //adds input of textarea to chatbubble list item
                    var chatInput = document.createElement('div');
                    chatInput.style.width =  '100%';
                    chatInput.style.textAlign= 'left';
                    chatInput.innerHTML = input;

                    chatBubble.appendChild(chatInput);
                
                    //adds chatBubble to chatlist
                    chatList.appendChild(chatBubble);

                    animateBotOutput();

                    
                
                    // checkInput(input);
                };

                function animateBotOutput() {
                    chatList.lastElementChild.style.animationDelay = animationCounter * animationBubbleDelay + "ms";
                    animationCounter++;
                    chatList.lastElementChild.style.animationPlayState = "running";
                }

                function responseText(e) {

                    var response = document.createElement('li');
                
                    response.classList.add('bot__output');
                
                    //Adds whatever is given to responseText() to response bubble
                    response.innerHTML = e;
                
                    chatList.appendChild(response);
                
                    animateBotOutput();
                
                    if(debug) console.log(response.clientHeight);
                
                    //Sets chatlist scroll to bottom
                    setTimeout(function () {
                    chatList.scrollTop = chatList.scrollHeight;
                    if(debug) console.log(response.clientHeight);
                    }, 0);
                };


                // if(win.width() >= mobile_width){
                //     createBubble('Click the Next button to start. We will keep track of your progress here.', null);
                //     animationCounter = 1;
                // }


                // Cognitive Distortions -- Request

                // var cognitive_distortion_server_list = ['https://105d-205-175-118-188.ngrok.io/api/cognitive_distortions'];

                function request_cognitive_distortion(situation, thought){


					$("#cognitive_distortions").append('<p class="mb-4"><span class="fs-3 mb-1" style="color: #055596;"><b>Thinking Traps</b></span><br/><span class="text-muted" style="font-size: 17px;">Step '+'{{thinking_trap_step_no}}' + ' of ' + '{{total_steps}}' + '</p>');
					
					
					if(psychoeducation == 1){
						$("#cognitive_distortions").append('<div class="row shadow-sm bg-body-tertiary" style="background-color: #ecf3fa; border-radius: 50px 50px 50px 0; padding: 30px 20px 20px 30px; margin-top: 15px; color: #144b5e; font-weight: 500; ">' + 
						'<p class="fs-5" style="color: #144b5e;"><i class="fas fa-info-circle"></i>&nbsp; <b>What\'s a Thinking Trap?</b></h4>' +
						'<p class="fs-5-5 mb-2" >Our negative thinking often falls into common patterns, called "thinking traps." We can learn to recognize when we\'re getting stuck in a thinking trap. This gives us more power over our negative thoughts.</p>' +
						'<p class="fs-5-5 my-2">Common thinking traps include: assuming what others think (“<i>Mind reading</i>”), thinking in extremes (“<i>All-or-nothing thinking</i>”), focusing on the worst-case scenario (“<i>Catastrophizing</i>”), focusing only on the bad (“<i>Disqualifying the positive</i>”), etc.</p>' +
						'</div>');
					}

					if(psychoeducation == 1){
						if(multiple_cognitive_distortions == 0){
							$("#cognitive_distortions_results").append('<p class="py-2 mt-4"><span class="pb-2" style="font-size: 2.2em;"><i class="fas fa-arrow-circle-right"></i>&nbsp; <b>Select the Thinking Trap</b></span><br/><span class="text-muted fs-5-5 mb-3" style="color: #144b5e; font-weight: 500;">Here are some thinking traps that might be related to your negative thought. Select the thinking trap that you most relate to.</span></p>');

							
						}
						
						else if(multiple_cognitive_distortions == 1){
							$("#cognitive_distortions_results").append('<p class="pt-2 mt-4"><span class="pb-2" style="font-size: 2.2em;"><i class="fas fa-arrow-circle-right"></i>&nbsp; <b>Select the Thinking Trap</b></span><br/><span class="text-muted fs-5-5" style="color: #144b5e; font-weight: 500;">Here are some thinking traps that might be related to your negative thought. Select the thinking trap that you most relate to.</span></p>');
						
							$("#cognitive_distortions_results").append('<p class="fs-5-5 mb-4" style="font-size: 1.6em;"><mark style="background-color:#fff3e0;"><b>Note:</b> You may select more than one thinking traps (up to three)</mark></p>');
						}
					}

					else if(psychoeducation == 0){
						if(multiple_cognitive_distortions == 0){
							$("#cognitive_distortions_results").append('<p class="py-2 mt-4">' + 
								'<span class="fs-5-5 mb-3">Our negative thinking often falls into common patterns, called "thinking traps." Here are some thinking traps that might be related to your negative thought. Select the thinking trap that you most relate to.</span></p>');

							
						}
						
						else if(multiple_cognitive_distortions == 1){
							$("#cognitive_distortions_results").append('<p class="pt-2 mt-4">' +
								'<span class="fs-5-5">Our negative thinking often falls into common patterns, called "thinking traps." Here are some thinking traps that might be related to your negative thought. Select the thinking trap that you most relate to.</span></p>');
						
							$("#cognitive_distortions_results").append('<p class="fs-5-5 mb-4" style="font-size: 1.6em;"><mark style="background-color:#fff3e0;"><b>Note:</b> You may select more than one thinking traps (up to three)</mark></p>');
						}
					}



 
                            
							// Iterate over DISTORTION_DEFINITIONS

							Object.keys(DISTORTION_SUBTEXT).forEach(function(key) {

								if(psychoeducation == 1){
									if(multiple_cognitive_distortions == 0){
										$("#cognitive_distortions_results").append('<div class="shadow-sm bg-body-tertiary q-box__question mt-3">' +
											'<input class="form-check-input question__input" id="' + key + '" name="cognitive_distortion_category" type="radio" value="' + key + '" required>' + 
											'<label class="form-check-label question__label" for="' + key + '"><span style="font-size: 2em; color: #616161;"><b>' + key + '</b></span>  <p class="text-muted my-1" style="font-size: 1.6em;">' + DISTORTION_SUBTEXT[key] + '</p>' + 
											'</label>' +
											'</div>');
									}

									else if(multiple_cognitive_distortions == 1){
										$("#cognitive_distortions_results").append('<div class="shadow-sm bg-body-tertiary q-box__question mt-3">' +
												'<input class="form-check-input question__input" id="' + key + '" name="cognitive_distortion_category" type="checkbox" value="' + key + '" required>' + 
												'<label class="form-check-label question__label" for="' + key + '"><span style="font-size: 2em; color: #616161;"><b>' + key + '</b></span>  <p class="text-muted my-1" style="font-size: 1.6em;">' + DISTORTION_SUBTEXT[key] + '</p>' + 
												'</label>' +
												'</div>');
									}
								}

								else if(psychoeducation == 0){
									if(multiple_cognitive_distortions == 0){
										$("#cognitive_distortions_results").append('<div class="shadow-sm bg-body-tertiary q-box__question mt-3">' +
											'<input class="form-check-input question__input" id="' + key + '" name="cognitive_distortion_category" type="radio" value="' + key + '" required>' + 
											'<label class="form-check-label question__label" for="' + key + '"><span style="font-size: 2em; color: #616161;"><b>' + key + '</b></span> </p>' + 
											'</label>' +
											'</div>');
									}

									else if(multiple_cognitive_distortions == 1){
										$("#cognitive_distortions_results").append('<div class="shadow-sm bg-body-tertiary q-box__question mt-3">' +
												'<input class="form-check-input question__input" id="' + key + '" name="cognitive_distortion_category" type="checkbox" value="' + key + '" required>' + 
												'<label class="form-check-label question__label" for="' + key + '"><span style="font-size: 2em; color: #616161;"><b>' + key + '</b></span> </p>' + 
												'</label>' +
												'</div>');
									}
								}
							});


							if(multiple_cognitive_distortions == 1){
								Array.from(document.querySelectorAll('input[name="cognitive_distortion_category"]')).forEach(function(checkbox) {
									// if(debug) console.log('added event listener');
									checkbox.addEventListener('change', onCheckboxClick);
								});
							}



							// $('#cognitive_distortions').classList.remove('d-none');
							// $('#cognitive_distortions').classList.add('d-block');


                }
				

				function rational_response_request_1_ajax(random_top_p, curr_cd){

					if(prompt_to_use == 'expert')
					{
						curr_url = "{% url 'diy_tool:rational_response_request_theme_1' %}";
					}

					else if(prompt_to_use == 'expert_new')
					{
						curr_url = "{% url 'diy_tool:rational_response_request_theme_new_1' %}";
					}

					else
					{
						curr_url = "{% url 'diy_tool:rational_response_request_1' %}";
					}

					return $.ajax({
                        type: "GET",
                        url: curr_url, 
                        data: {"thought_record_id": thought_record_id, "situation": situation, "thought": thought, "cognitive_distortion_category": curr_cd, "random_top_p": random_top_p, "readable": readable,},
                        dataType: "json",
                        success: function(response){
							// reframed_thought_1 = response['reframed_thought'];
							// prompt_type_1 = response['prompt_type'];
						}, error : function(xhr, errmsg, err) {
                            if(debug) console.log('request_failed', errmsg);
                        }
                    });

				}


				function rational_response_request_2_ajax(random_top_p, curr_cd){

					if(prompt_to_use == 'expert')
					{
						curr_url = "{% url 'diy_tool:rational_response_request_theme_2' %}";
					}
					
					else if(prompt_to_use == 'expert_new')
					{
						curr_url = "{% url 'diy_tool:rational_response_request_theme_new_2' %}";
					}

					else
					{
						curr_url = "{% url 'diy_tool:rational_response_request_2' %}";
					}

					return $.ajax({
                        type: "GET",
                        url: curr_url, 
                        data: {"thought_record_id": thought_record_id, "situation": situation, "thought": thought, "cognitive_distortion_category": curr_cd, "random_top_p": random_top_p, "readable": readable,},
                        dataType: "json",
                        success: function(response){
							// reframed_thought_2 = response['reframed_thought'];
							// prompt_type_2 = response['prompt_type'];
						}, error : function(xhr, errmsg, err) {
                            if(debug) console.log('request_failed', errmsg);
                        }
                    });

				}

				function rational_response_request_matched_ajax(){
					return $.ajax({
                        type: "GET",
                        url: "{% url 'diy_tool:rational_response_request_matched' %}", 
                        data: {"thought_record_id": thought_record_id, "situation": situation, "thought": thought, "cognitive_distortion_category": cognitive_distortion_category,},
                        dataType: "json",
                        success: function(response){
							reframed_thought_1 = response['reframed_thought_1'];
							prompt_type_1 = response['prompt_type_1'];

							reframed_thought_2 = response['reframed_thought_2'];
							prompt_type_2 = response['prompt_type_2'];

						}, error : function(xhr, errmsg, err) {
                            if(debug) console.log('request_failed', errmsg);
                        }
                    });

				}

				function rational_response_request_single_ajax(){
					return $.ajax({
                        type: "GET",
                        url: "{% url 'diy_tool:rational_response_request_single' %}", 
                        data: {"thought_record_id": thought_record_id, "situation": situation, "thought": thought, "cognitive_distortion_category": cognitive_distortion_category,},
                        dataType: "json",
                        success: function(response){
							reframed_thought_1 = response['reframed_thought'];
							prompt_type_1 = response['prompt_type'];
						}, error : function(xhr, errmsg, err) {
                            if(debug) console.log('request_failed', errmsg);
                        }
                    });

				}


				function rational_response_request_attributes_ajax(){
					return $.ajax({
                        type: "GET",
                        url: "{% url 'diy_tool:rational_response_request_attributes' %}", 
                        data: {"thought_record_id": thought_record_id, "situation": situation, "thought": thought, "cognitive_distortion_category": cognitive_distortion_category,},
                        dataType: "json",
                        success: function(response){
							reframed_thought_1 = response['reframed_thought_1'];
							prompt_type_1 = response['prompt_type_1'];

							reframed_thought_2 = response['reframed_thought_2'];
							prompt_type_2 = response['prompt_type_2'];

						}, error : function(xhr, errmsg, err) {
                            if(debug) console.log('request_failed', errmsg);
                        }
                    });

				}				


				function rational_response_request_3_ajax(random_top_p, curr_cd){
					return $.ajax({
                        type: "GET",
                        url: "{% url 'diy_tool:rational_response_request_3' %}", 
                        data: {"thought_record_id": thought_record_id, "situation": situation, "thought": thought, "cognitive_distortion_category": curr_cd, "random_top_p": random_top_p, "readable": readable,},
                        dataType: "json",
                        success: function(response){
							
						}, error : function(xhr, errmsg, err) {
                            if(debug) console.log('request_failed', errmsg);
                        }
                    });

				}

				function rational_response_request_theme_1_ajax(){
					return $.ajax({
						type: "GET",
						url: "{% url 'diy_tool:rational_response_request_theme_1' %}", 
						data: {"thought_record_id": thought_record_id, "situation": situation, "thought": thought, "cognitive_distortion_category": cognitive_distortion_category, "readable": readable,},
						dataType: "json",
						success: function(response){
						
						}, error : function(xhr, errmsg, err) {
							if(debug) console.log('request_failed', errmsg);
						}
					});
				}

				function refresh_rational_response(situation, thought, cognitive_distortion_category){
					var reframed_thought_1 = "";
					var reframed_thought_2 = "";
					var reframed_thought_3 = "";

					var prompt_type_1 = "";
					var prompt_type_2 = "";
					var prompt_type_3 = "";

					// Fade out, fade in

					$('#reframe_list').fadeOut(300, function(){
						$('#reframe_list').html('<div id="reframes_loading" style="align-items: center;" class="my-3">' +
							'<img src="https://raw.githubusercontent.com/ash-shar/DISHELPER/master/Spin-1s-200px.svg" style="vertical-align:middle; margin-right: 10px; width: 45px;" class="img-responsive" /> <span style="vertical-align: middle; color: #144b5e;" class="fs-3">Loading More Reframes...</span>' +
						 '</div>');
						$('#reframe_list').fadeIn(300);
					});

					

					$.when(rational_response_request_1_ajax(1), rational_response_request_2_ajax(1), rational_response_request_3_ajax(1),).done(function(a1,a2,a3){

					// $.when(rational_response_request_attributes_ajax(), rational_response_request_3_ajax(),).done(function(a1,a2){
						// the code here will be executed when all three ajax requests resolve.
						// a1, a2, a3 and a4 are lists of length 3 containing the response text,
						// status, and jqXHR object for each of the three ajax calls respectively.

						// reframed_thought_1 = a1['reframed_thought'];
						// prompt_type_1 = a1['prompt_type'];

						// reframed_thought_1 = a1[0]['reframed_thought_1'];
						// prompt_type_1 = a1[0]['prompt_type_1'];

						// reframed_thought_2 = a1[0]['reframed_thought_2'];
						// prompt_type_2 = a1[0]['prompt_type_2'];

						reframed_thought_1 = a1[0]['reframed_thought'];
						prompt_type_1 = a1[0]['prompt_type'];

						reframed_thought_2 = a2[0]['reframed_thought'];
						prompt_type_2 = a2[0]['prompt_type'];

						curr_theme = a2[0]['theme'];


						reframed_thought_3 = a3[0]['reframed_thought'];
						prompt_type_3 = a3[0]['prompt_type'];

						$.ajax({
							type: "GET",
							url: "{% url 'diy_tool:combine_reframed_thoughts' %}", 
							data: {"thought_record_id": thought_record_id, "cognitive_distortion_category": cognitive_distortion_category, "reframed_thought_1": reframed_thought_1, "reframed_thought_2": reframed_thought_2, "reframed_thought_3": reframed_thought_3, "prompt_type_1": prompt_type_1, "prompt_type_2": prompt_type_2, "prompt_type_3": prompt_type_3,},
							// data: {"thought_record_id": thought_record_id, "cognitive_distortion_category": cognitive_distortion_category, "reframed_thought_1": reframed_thought_1, "prompt_type_1": prompt_type_1,},
							dataType: "json",
							success: function(response){

								reframes_generated_id = response['reframes_generated_id'];

								out = response['out'];
								cognitive_distortion_definition = response['cognitive_distortion_definition']

								if(debug) console.log(out);

									
									$('#reframe_list').fadeIn(300, function(){

										$('#reframe_list').html("");

										for(var i=0; i < out.length; i++)
										{
											if(debug) console.log(out[i].length);
												$("#reframe_list").append('<div class="q-box__question mt-4">' +
																			'<input class="form-check-input question__input" id="rational_response_'+ i + '" name="rational_response" type="radio" value="'+ out[i].replace(/\"/g, '&quot;') + '">' +
																			'<label class="form-check-label question__label pb-2" for="rational_response_'+ i + '">' + 
																			'<span style="font-size: 1.7em; color: #144b5e;" class="py-1"><i>' + out[i] + '</i></span></label>' +
																			'<div class="row mb-2">' +
																				'<div class="feedback_wrapper ms-3">' +
																				// '<div class="feedback_radio_group feedback_radio_like form-check form-check-inline mx-0">' +
																				// '<input class="form-check-input" type="radio" name="like_' + i +  '" id="like_' + i + '"  value="<LIKE>:' + out[i].replace(/\"/g, '&quot;') + '">' +
																				// '<label class="form-check-label" for="like_' + i + '">' +
																				// '<i class="fas fa-heart"></i> I relate' +
																				// '</label>' +
																				// '</div>' +
																				// '<div class="feedback_radio_group feedback_radio_dislike form-check form-check-inline mx-0">' +
																				// '<input class="form-check-input" type="radio" name="like_' + i +  '" id="dislike_' + i + '"  value="<DISLIKE>:' + out[i].replace(/\"/g, '&quot;') + '">' +
																				// '<label class="form-check-label" for="dislike_' + i + '">' +
																				// '<i class="fas fa-thumbs-down"></i> dislike' +
																				// '</label>' +
																				// '</div>' +
																				'<div class="feedback_radio_group feedback_radio_flag form-check form-check-inline mx-0">' +
																				'<input class="form-check-input feedback_radio_flag_input" type="radio" name="like_' + i +  '" id="flag_' + i + '" value="' + out[i].replace(/\"/g, '&quot;') + '">' +
																				'<label class="form-check-label" for="flag_' + i + '">' +
																				'<i class="fas fa-flag"></i> Flag inappropriate' +
																				'</label>' +
																				'</div>' +
																				'</div>' +
																				'</div>' +
																				'</div>');
										}

										$('#reframe_list').append('<div class="q-box__question mt-3 mb-4">' + 
																		'<input class="form-check-input question__input" id="new" name="rational_response" type="radio" value="new">' +
																		'<label class="form-check-label question__label" for="new">' + 
																		'<div id="rational_response_editable" class="py-1 pb-4 px-1" contenteditable="true" style="font-size:1.7em; color: #144b5e;">Add your own reframe<br/></div></label>'+
																		'</div>');

										// Add a refresh button similar to start over
										// if(refresh_btn == 1){
										// 	$('#reframe_list').append('<p class="fs-5"><button type="button" id="refresh_btn"><i class="fas fa-sync-alt" aria-hidden="true"></i>&nbsp;&nbsp;Refresh Suggested Reframes</button></p>'); 
										// }
									}
									
									);

								},
							error : function(xhr, errmsg, err) {
								if(debug) console.log('request_failed', errmsg);
							}

						});

					});
				}


				function add_suggestions_rational_response(situation, thought, cognitive_distortion_category_li){

					var curr_cd_li = [];

					// add elements from the cognitive_distortion_category
					// to the curr_cd_li list

					for(var i=0; i < cognitive_distortion_category_li.length; i++){
						curr_cd_li.push(cognitive_distortion_category_li[i]);
					}

					while (curr_cd_li.length < 3){
						// add cognitive_distortion_category[0]
						curr_cd_li.push(cognitive_distortion_category_li[0]);
					}

					var new_reframed_thought_1 = "";
					var new_reframed_thought_2 = "";
					var new_reframed_thought_3 = "";

					var new_prompt_type_1 = "";
					var new_prompt_type_2 = "";
					var new_prompt_type_3 = "";

					// Fade out, fade in

					$('#more_suggestions_p').remove();

					// $('#reframe_list').fadeOut(300, function(){
						// $('#reframe_list').append('<div id="reframes_loading" style="align-items: center;" class="my-3">' +
						// 	'<img src="https://raw.githubusercontent.com/ash-shar/DISHELPER/master/Spin-1s-200px.svg" style="vertical-align:middle; margin-right: 10px; width: 45px;" class="img-responsive" /> <span style="vertical-align: middle; color: #144b5e;" class="fs-3">Loading New Suggestions...</span>' +
						//  '</div>');
					// 	$('#reframe_list').fadeIn(300);
					// });
					
					$("#reframe_list").append('<div id="skeleton_rr_div_1" class="shadow-sm bg-body-tertiary mt-3 skeleton skeleton-text skeleton-text__body py-4">' +
					'</div>');

					$("#reframe_list").append('<div id="skeleton_rr_div_2" class="shadow-sm bg-body-tertiary mt-3 skeleton skeleton-text skeleton-text__body py-4">' +
					'<br/><br/>' +
					'</div>');

					$("#reframe_list").append('<div id="skeleton_rr_div_3" class="shadow-sm bg-body-tertiary mt-3 skeleton skeleton-text skeleton-text__body py-4">' +
					'<br/><br/>' +
					'</div>');
					

					$.when(rational_response_request_1_ajax(1, curr_cd_li[2]), rational_response_request_2_ajax(1, curr_cd_li[1]), rational_response_request_3_ajax(1, curr_cd_li[0]),).done(function(a1,a2,a3){

					// $.when(rational_response_request_attributes_ajax(), rational_response_request_3_ajax(),).done(function(a1,a2){
						// the code here will be executed when all three ajax requests resolve.
						// a1, a2, a3 and a4 are lists of length 3 containing the response text,
						// status, and jqXHR object for each of the three ajax calls respectively.

						// reframed_thought_1 = a1['reframed_thought'];
						// prompt_type_1 = a1['prompt_type'];

						// reframed_thought_1 = a1[0]['reframed_thought_1'];
						// prompt_type_1 = a1[0]['prompt_type_1'];

						// reframed_thought_2 = a1[0]['reframed_thought_2'];
						// prompt_type_2 = a1[0]['prompt_type_2'];

						new_reframed_thought_1 = a1[0]['reframed_thought'];
						new_prompt_type_1 = a1[0]['prompt_type'];

						new_reframed_thought_2 = a2[0]['reframed_thought'];
						new_prompt_type_2 = a2[0]['prompt_type'];


						new_reframed_thought_3 = a3[0]['reframed_thought'];
						new_prompt_type_3 = a3[0]['prompt_type'];

						$.ajax({
							type: "GET",
							url: "{% url 'diy_tool:combine_reframed_thoughts_new' %}", 
							data: {"thought_record_id": thought_record_id, "cognitive_distortion_category": cognitive_distortion_category, "new_reframed_thought_1": new_reframed_thought_1, "new_reframed_thought_2": new_reframed_thought_2, "new_reframed_thought_3": new_reframed_thought_3, "new_prompt_type_1": new_prompt_type_1, "new_prompt_type_2": new_prompt_type_2, "new_prompt_type_3": new_prompt_type_3, "old_reframed_thought_1": reframed_thought_1, "old_reframed_thought_2": reframed_thought_2, "old_reframed_thought_3": reframed_thought_3, "old_prompt_type_1": prompt_type_1, "old_prompt_type_2": prompt_type_2, "old_prompt_type_3": prompt_type_3, 'this_is_a_difficult_situation': this_is_a_difficult_situation},
							// data: {"thought_record_id": thought_record_id, "cognitive_distortion_category": cognitive_distortion_category, "reframed_thought_1": reframed_thought_1, "prompt_type_1": prompt_type_1,},
							dataType: "json",
							success: function(response){


								reframes_generated_id = response['reframes_generated_id'];

								out = response['out'];
								cognitive_distortion_definition = response['cognitive_distortion_definition']

								if(debug) console.log(out);

								$("#skeleton_rr_div_1").remove();
								$("#skeleton_rr_div_2").remove();
								$("#skeleton_rr_div_3").remove();

									
									$('#reframe_list').fadeIn(300, function(){

										$("#reframes_loading").remove();
										
										// Remove more_suggestions_p and add_your_own_reframe
										
										$('#add_your_own_reframe').remove();

										for(var i=3; i < out.length + 3; i++)
										{
											if(debug) console.log(out[i-3].length);
												$("#reframe_list").append('<div class="q-box__question mt-4">' +
																			'<input class="form-check-input question__input" id="rational_response_'+ i + '" name="rational_response" type="radio" value="'+ out[i-3].replace(/\"/g, '&quot;') + '">' +
																			'<label class="form-check-label question__label pb-2" for="rational_response_'+ i + '">' + 
																			'<span style="font-size: 1.7em; color: #144b5e;" class="py-1"><i>' + out[i-3] + '</i></span></label>' +
																			'<div class="row mb-2">' +
																				'<div class="feedback_wrapper ms-3">' +
																				// '<div class="feedback_radio_group feedback_radio_like form-check form-check-inline mx-0">' +
																				// '<input class="form-check-input" type="radio" name="like_' + i +  '" id="like_' + i + '"  value="<LIKE>:' + out[i].replace(/\"/g, '&quot;') + '">' +
																				// '<label class="form-check-label" for="like_' + i + '">' +
																				// '<i class="fas fa-heart"></i> I relate' +
																				// '</label>' +
																				// '</div>' +
																				// '<div class="feedback_radio_group feedback_radio_dislike form-check form-check-inline mx-0">' +
																				// '<input class="form-check-input" type="radio" name="like_' + i +  '" id="dislike_' + i + '"  value="<DISLIKE>:' + out[i].replace(/\"/g, '&quot;') + '">' +
																				// '<label class="form-check-label" for="dislike_' + i + '">' +
																				// '<i class="fas fa-thumbs-down"></i> dislike' +
																				// '</label>' +
																				// '</div>' +
																				'<div class="feedback_radio_group feedback_radio_flag form-check form-check-inline mx-0">' +
																				'<input class="form-check-input feedback_radio_flag_input" type="radio" name="like_' + i +  '" id="flag_' + i + '" value="' + out[i-3].replace(/\"/g, '&quot;') + '">' +
																				'<label class="form-check-label" for="flag_' + i + '">' +
																				'<i class="fas fa-flag"></i> Flag inappropriate' +
																				'</label>' +
																				'</div>' +
																				'</div>' +
																				'</div>' +
																				'</div>');
										}

										$('#reframe_list').append('<div class="q-box__question mt-3 mb-4" id="add_your_own_reframe">' + 
																		'<input class="form-check-input question__input" id="new" name="rational_response" type="radio" value="new">' +
																		'<label class="form-check-label question__label" for="new">' + 
																		'<div id="rational_response_editable" class="py-1 pb-4 px-1" contenteditable="true" style="font-size:1.7em; color: #144b5e;">Add your own reframe<br/></div></label>'+
																		'</div>');

										// Add a refresh button similar to start over
										// if(refresh_btn == 1){
										// 	$('#reframe_list').append('<p class="fs-5"><button type="button" id="refresh_btn"><i class="fas fa-sync-alt" aria-hidden="true"></i>&nbsp;&nbsp;Refresh Suggested Reframes</button></p>'); 
										// }
									}
									
									);

								},
							error : function(xhr, errmsg, err) {
								if(debug) console.log('request_failed', errmsg);
							}

						});

					});
				}



                function request_rational_response(situation, thought, cognitive_distortion_category_li, distortion_definition_li){

					var curr_cd_li = [];

					// add elements from the cognitive_distortion_category
					// to the curr_cd_li list

					for(var i=0; i < cognitive_distortion_category_li.length; i++){
						curr_cd_li.push(cognitive_distortion_category_li[i]);
					}

					while (curr_cd_li.length < 3){
						// add cognitive_distortion_category[0]
						curr_cd_li.push(cognitive_distortion_category_li[0]);
					}

					if(debug) console.log('cognitive_distortion_category_li:', cognitive_distortion_category_li);
					if(debug) console.log('curr_cd_li:', curr_cd_li);
					if(debug) console.log('distortion_definition_li:', distortion_definition_li);


					$("#rational_response").append('<p class="mb-4"><span class="fs-3 mb-1" style="color: #055596;"><b>Reframing</b></span><br/><span class="text-muted" style="font-size: 17px;">Step '+'{{reframe_step_no}}' + ' of ' + '{{total_steps}}' + '</p>');
					
					if(psychoeducation == 1){
						$("#rational_response").append('<div class="row shadow-sm bg-body-tertiary" style="background-color: #ecf3fa; border-radius: 50px 50px 50px 0; padding: 30px 20px 20px 30px; margin-top: 15px; color: #144b5e; font-weight: 500; ">' + 
						'<p class="fs-5" style="color: #144b5e;"><i class="fas fa-info-circle"></i>&nbsp; <b>What is Reframing?</b></h4>' +
						'<p class="fs-5-5 mb-2">We overcome thinking traps by coming up with new ways to think about the situation we are dealing with. This process is called <b>reframing</b>.</p>' +
						'</div>');


						var tips_definitions = '';

						for(var i=0; i < distortion_definition_li.length; i++){

							if(cognitive_distortion_category_li[i] != "None of These Thinking Traps Seem Right to Me"){
								tips_definitions += '<div class="row">' +
										'<p class="fs-5-5 my-1 text-muted"><b>' + cognitive_distortion_category_li[i] + ':</b> ' + distortion_definition_li[i] + '</p>' +
									'</div>';
							}
						}

						if(multiple_cognitive_distortions == 0){
							if(cognitive_distortion_category != "None of These Thinking Traps Seem Right to Me"){
								$("#rational_response").append('<div class="row my-4">' +
								'<div class="col-12">' +
								'<div id="accordion">' +
								'<div class="row shadow-sm bg-body-tertiary mb-3" style="background-color: #fafafa; border-radius: 50px 50px 50px 0; padding: 30px 20px 20px 30px; color: #144b5e; font-weight: 500; ">' +
									'<div class="fs-5-5" id="tips_heading">' +
										'<button class="collapsed" data-toggle="collapse" style="color: #144b5e;padding: 0; border: 0; background: 0 0; text-decoration: none;" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne"><i class="fas fa-plus"></i>&nbsp; <b>Tips to Overcome ' + cognitive_distortion_category + ' </b>' +
										'</button>' +
									'</div>' +
									'<div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">' +
									'<div>' +
										'<div class="row">' +
											'<p class="fs-5-5 my-1 text-muted">' + distortion_definition_li[0] + '</p>' +
										'</div>' +
										'</div>' +
										'</div>' +
										'</div>' +
								'</div>' +
								'</div>' +
								'</div>');
							}
						}

						else if(multiple_cognitive_distortions == 1){

							$("#rational_response").append('<div class="row my-4">' +
							'<div class="col-12">' +
							'<div id="accordion">' +
							'<div class="row shadow-sm bg-body-tertiary mb-3" style="background-color: #fafafa; border-radius: 50px 50px 50px 0; padding: 30px 20px 20px 30px; color: #144b5e; font-weight: 500; ">' +
								'<div class="fs-5-5" id="tips_heading">' +
									'<button class="collapsed" data-toggle="collapse" style="color: #144b5e;padding: 0; border: 0; background: 0 0; text-decoration: none;" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne"><i class="fas fa-plus"></i>&nbsp; <b>Tips to Overcome Thinking Traps </b>' +
									'</button>' +
								'</div>' +
								'<div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">' +
								'<div>' + tips_definitions + '</div>' +
							'</div>' +
							'</div>' +
							'</div>' +
							'</div>' +
							'</div>');
						}
					}

						$("#rational_response_results").append('<p class="fs-5-5 my-2">What can you tell yourself to think about this situation in a <b>more positive, realistic, or helpful way?</b></p>');


						$("#rational_response_results").append('<div class="reframe-edit-div form-group mt-3">' +
								'<div>' + 
								'<textarea class="mt-2" id="rational_response_text_orig" name="rational_response_text_orig" placeholder="Write your reframe here" rows=3 required></textarea>' +
								  '</div>' +
							'</div>')


                    };

                    // $(".selectpicker").selectpicker({
                    //     "title": "Select Options"        
                    // }).selectpicker("render");

                    $("select").selectpicker();
                    // $(".bootstrap-select").click(function () {
                    //     $(this).addClass("open");
                    // });

                    // $('.multiselect').multiselect({
                    //     buttonWidth: '100px'
                    // });


                });
        </script>


        <!-- <header class="blog-header pb-2 pt-4">
            <div class="row flex-nowrap justify-content-between align-items-center">
                <div class="col-3 pt-2">
                </div>
                <div class="col-6 text-center">
                <strong><a id="field-iteration" class="blog-header-logo text-dark pt-2" href="#">Cognitive Restructuring</a></strong>
                </div>
                <div class="col-3 d-flex align-items-center">
                </div>
            </div>
            <div class="row justify-content-between align-items-center text-center text-muted">
                <p>Spot the cognitive distortions and reframe your distorted thoughts!</p></div>
        </header> -->


    <!-- <div class="container align-items-center">
        <div class="row justify-content-center">
            <p>In this activity, you will learn skills to overcome a thought you struggle with. With practice, you can integrate these skills into your life, helping you gain greater control over your thoughts and actions.</p>
        </div>
    </div> -->



	<!-- <ol class="progress-pane">
		<li class="is-complete"><span>Consent</span></li>  
		<li class="is-active"><span>Thought</span></li>  
		<li><span>Situation</span></li>
		<li><span>Thinking Trap</span></li>  
		<li><span>Reframe</span></li>
		<li><span>Evaluate</span></li>
		<li><span>Summary</span></li>
	  </ol> -->

	  
	 


    <div class="container my-1 align-items-center" id="full-page-container">

        <div class="row g-0 justify-content-center" style="border: 5px solid #fff;">
        <!-- FORMS -->

		<div class="col-lg-3 mx-0 px-0 shadow-sm bg-body-tertiary card" id="chatbot-container-div" style="display: none; border-radius: 0rem !important;">
            <div id="chatbot-container">

				<div id="chatbot-list" style="font-size: 1.7em;" class="mt-4 ms-4">
                <div class="side-step side-step-active" id="side-thought">
					<div>
					   <div class="side-circle" id="thought-circle">1</div>
					</div>
					<div>
					   <div class="side-title">Thought</div>
					   <div class="side-caption" id="thought-caption"></div>
					</div>
				 </div>

				 {% if 3 not in skip_step_li %}
				 <div class="side-step" id="side-emotion">
					<div>
					   <div class="side-circle" id="emotion-circle">{{emotion_step_no}}</div>
					</div>
					<div>
					   <div class="side-title">Emotion</div>
					   <div class="side-caption" id="emotion-caption"></div>
					</div>
				 </div>
				 {% endif %}

				 
				 {% if 4 not in skip_step_li%}
				 <div class="side-step"  id="side-situation">
					<div>
					   <div class="side-circle" id="situation-circle">{{situation_step_no}}</div>
					</div>
					<div>
					   <div class="side-title">Situation</div>
					   <div class="side-caption" id="situation-caption"></div>
					</div>
				 </div>
				 {% endif %}

				 {% if 5 not in skip_step_li %}
				 <div class="side-step" id="side-thinking-trap">
					<div>
					   <div class="side-circle" id="thinking-trap-circle">{{thinking_trap_step_no}}</div>
					</div>
					<div>
					   <div class="side-title">Thinking Trap</div>
					   <div class="side-caption"  id="thinking-trap-caption"></div>
					</div>
				 </div>
				 {% endif %}


				 <div class="side-step" id = "side-reframe">
					<div>
					   <div class="side-circle" id="reframe-circle">{{reframe_step_no}}</div>
					</div>
					<div>
					   <div class="side-title">Reframe</div>
					   <div class="side-caption" id="reframe-caption"></div>
					</div>
				 </div>
				 <div class="side-step" id="side-survey">
					<div>
					   <div class="side-circle" id="survey-circle">{{evaluate_step_no}}</div>
					</div>
					<div>
					   <div class="side-title">Survey</div>
					   <div class="side-caption"></div>
					</div>
				 </div>
			
				 </div>

                  <div class="row" id="start_over_div">
                    <p class="fs-5"><button type="button" id="start_over"><i class="fas fa-redo" aria-hidden="true"></i>&nbsp;&nbsp;Start Over</button></p>
                  </div>
            </div>
         </div>

     
        <div class="col-lg-8 mx-0 px-0 shadow-sm bg-body-tertiary card" id="qbox-div" style="background-color: #fff; border-radius: 0rem !important; border-left: 0px !important;">
            <div id="qbox-container" >
                <div id="qbox-container-inner">
               <form class="needs-validation" id="form-wrapper" method="post" name="form-wrapper" novalidate="">
                  <div id="steps-container">
					<!-- Add a progress bar -->

                    <div class="step">

						<!-- <div class="progress"  role="progressbar" aria-label="Example 1px high" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100" style="height: 3px">
							<div class="progress-bar" style="width: 25%"></div>
						  </div> -->

                        <div class="row mt-3">

                            <p class="fs-5-5">Sometimes life can feel overwhelming. We get stuck in patterns of negative thinking, called "<a href="https://screening.mhanational.org/content/thinking-traps-how-can-i-deal-with-negative-thoughts/" target="_blank" class="ext_url"><span style="color: #055596;"><b><i>thinking traps</i></b></span></a>." Things can start to feel hopeless &mdash; but the truth is, there's always hope.</p>
                                                        
                            <p class="fs-5-5">Breaking free from thinking traps is a skill that you can learn. You can replace negative, hopeless thoughts with ones that are <b>more positive, realistic, or helpful</b>. In this activity, you will practice doing just that.</p>

                            <p class="fs-5-5 mt-4 mb-3">This activity <b>isn't monitored by a human</b>. If you are thinking about death, suicide, or self-harm and need to talk to someone right away, please text MHA to 741741 or call or text 988.</p>

                    </div>
                    </div>



                    <div class="step">

                        <div class="row">

                            <p class="fs-3 mb-3" style="color: #055596;"><b>Consent Form</b></p>


                            <p class="fs-5-5">This tool is part of a research study in collaboration with the University of Washington.</p>
                             
                            <p class="fs-5-5"><b>Purpose:</b> The purpose of the study is to understand how digital tools can help people recognize thinking traps and practice reframing negative thoughts.</p>


                            <p class="fs-5-5 mt-1"><b>Procedure:</b> You will be asked to describe a thought and a situation you are struggling with. You will then identify potential "thinking traps" (or cognitive distortions) in the thought and reframe it in a way that is more positive, realistic, or helpful. Finally, you will be asked to take an <i>optional</i> demographic survey, which can be skipped as preferred. The tool is expected to take ~5 minutes to complete.</p>

                            <p class="fs-5-5 mt-1"><b>Benefits:</b> By using this tool, you may learn about thinking traps. You will practice identifying them and reframing negative thoughts and situations. However, there is no guarantee that the tool will help you reframe your thoughts.</p>

                            <p class="fs-5-5"><b>Data Collection and Sharing:</b> We will not ask you for your name or any identifiable personal information. Usage data will be made unidentifiable to the best of our extent, will be analyzed to improve the tool, and may be shared and used for future research.</p>



                            <p class="fs-5-5 mt-1"><b>Risks:</b> Talking about situations and thoughts you are struggling with may be disturbing to you and may bring up negative emotional reactions. In addition, the tool may use automatic content generation methods. Appropriate steps have been taken to avoid harmful content generation, but there is a possibility that the generated content might be upsetting to you. Also, the <i>optional</i> demographic survey asks for information that may be sensitive and could make you feel uncomfortable (e.g., "<i>What are the main things contributing to your mental health problems right now?</i>"). This tool is not being actively monitored by a human and should not be used as a "cry for help" outlet. Should you have a strong negative reaction to some of the content, you can text MHA to 741741 or call or text 988.</p>

                            <p class="fs-5-5 mt-1"><b>Participation:</b> Participation in this study is completely voluntary. You will not receive any payment for participation. You can refuse participation or stop participating at any time without penalty or loss of benefits to which you are otherwise entitled.</p>


                            <p class="fs-5-5 mt-1"><b>Contact Us:</b> If you have questions or concerns about this research, or if you think you have been harmed from being in the study, please email us (Ashish Sharma at ashshar@cs.washington.edu, or Professor Tim Althoff at althoff@cs.washington.edu). If you have questions about your rights as a research participant, you can call the University of Washington Human Subjects Division at (206) 543-0098.</p>


                            




                            <!-- <div class="row mt-3">
                                <div class="col-12">
                                <div class="card">
                                    <div class="card-header fs-5-5">
                                        <strong>Purpose</strong>
                                      </div>                                
                                      <div class="card-body">
                                        <div class="row">
                                            <p class="fs-5-5">The purpose of the study is to understand how to design tools to help people learn how to recognize thinking traps and practice thinking in ways that are more helpful, positive, or realistic.</p>
                                        </div>
                                        
                                        </div>
                                  </div>
                                </div>
                            </div>


                            <div class="row mt-4">
                                <div class="col-12">
                                <div class="card">
                                    <div class="card-header fs-5-5">
                                        <strong>Procedure</strong>
                                      </div>                                
                                      <div class="card-body">
                                        <div class="row">
                                            <p class="fs-5-5">You will practice identifying one "thinking trap" and learn how it can be reworked into a less troubling thought. You will be asked to describe a thought and a situation you are struggling with. You will then identify the potential thinking traps in the thought and come up with a reframed thought to deal with the thinking trap.</p>

                                            <p class="fs-5-5 mt-1">We will not ask you for your name or any identifiable information. Usage data will be analyzed to improve the tool and will be shared with the research teams at the University of Washington and Mental Health America.</p>
                                        </div>
                                        
                                        </div>
                                  </div>
                                </div>
                            </div>



                            <div class="row mt-4">
                                <div class="col-12">
                                <div class="card">
                                    <div class="card-header fs-5-5">
                                        <strong>Risks</strong>
                                      </div>                                
                                      <div class="card-body">
                                        <div class="row">
                                            <p class="fs-5-5">Talking about situations and thoughts you are struggling with may be disturbing to you and may evoke negative emotional reactions. Also, the tool uses artificial intelligence to generate reframed thoughts. Appropriate steps have been taken to avoid harmful reframes, but there is a possibility that the generated content might be upsetting to you.</p>

                                            <p class="fs-5-5 mt-1">Should you have a strong negative reaction to some of the content, you can text MHA to 741741 or call or text 988.</p>

                                            <p class="fs-5-5 mt-1"><b>Contact Us:</b> If you have questions or concerns about this research, please email us (Ashish Sharma at ashshar@cs.washington.edu, or Professor Tim Althoff at althoff@cs.washington.edu). If you have questions about your rights as a research participant, or wish to obtain information, ask questions or discuss any concerns about this study with someone other than the researcher(s), please contact the University of Washington Human Subjects Division at 206-543-0098 (for international calls include the US Calling Code: +1-206-543-0098).</p>
                                        </div>
                                        
                                        </div>
                                  </div>
                                </div>
                            </div>


                            <div class="row mt-4">
                                <div class="col-12">
                                <div class="card">
                                    <div class="card-header fs-5-5">
                                        <strong>Benefits</strong>
                                      </div>                                
                                      <div class="card-body">
                                        <div class="row">
                                            <p class="fs-5-5">By using this tool, you may learn about thinking traps, how to identify them in your thoughts and how they can be reframed into a less troubling thought.</p>
                                        </div>
                                        
                                        </div>
                                  </div>
                                </div>
                            </div> -->






                            <div class="checkbox form-check fs-5-5 mt-3 mb-4 ms-3 me-4">
                                <input type="checkbox" class="form-check-input" name="consent" id="consent" value="consent" required><label class="form-check-label" for="consent">By ticking this box, you are agreeing to use this tool. You are also confirming that you are at least 13 years old. Be sure that questions about the tool have been answered and that you understand what you are being asked to do. You may contact us if you think of a question later. You are free to stop using the tool at any time. To save a copy of this consent form, you can use <a href="https://docs.google.com/document/d/e/2PACX-1vSx1CzdfNJWap3I4rUjEDMgiHGGteQ-cJ7Fz7n_RiKTbs7KojzWJ-w642OEVGLA2ZcZ24O6x8dZL6us/pub" class="ext_url" target="_blank">this link</a>.</label>
                            </div> 

                            <p class="mb-2" id="empty_consent" style="display: none; font-size: 1.6em;"><mark style="background-color:#fff3e0;">You must select the checkbox to continue.</mark></p>

                    </div>
                    </div>


					<!-- Style: Rounded borders -->
                     <div class="step">
                        <div class="row">

							<p class="mb-4"><span class="fs-3 mb-1" style="color: #055596;"><b>Thought</b></span><br/><span class="text-muted" style="font-size: 17px;">Step 1 of {{total_steps}}</span></p>

                            <div class="col-12" >
								
								{% if 4 not in skip_step_li%}
                                <label for="thought" class="py-2 mb-1"><span style="font-size: 2em;"><i class="fas fa-arrow-circle-right"></i>&nbsp; <b>What negative thought are you struggling with right now?</b></span>&nbsp;
                                </label>
								{% else %}
									{% if descriptive_thought_Q == 1 %}
										<label for="thought" class="py-2 mb-1"><span style="font-size: 2em;"><i class="fas fa-arrow-circle-right"></i>&nbsp; <b>What negative thought are you struggling with right now? Any recent situation that led to this thought?</b></span>&nbsp;
										</label>
									{% else %}
										<label for="thought" class="py-2 mb-1"><span style="font-size: 2em;"><i class="fas fa-arrow-circle-right"></i>&nbsp; <b>What negative thought are you struggling with right now?</b></span>&nbsp;
										</label>
									{% endif %}

								{% endif %}

                                <div class="form-group mb-4 mt-2">		
                            <textarea  id="thought" name="thought" placeholder="Enter your thought here" rows=3 required></textarea>
                            </div>

                            <p class="mb-2" id="empty_thought" style="display: none; font-size: 1.6em;"><mark style="background-color:#fff3e0;">Please type your thought in the textbox above.</mark></p>

                            </div>

                            </div>
                    </div>


					<div class="step">
                        <div class="row">

							<p class="mb-3"><span class="fs-3 mb-1" style="color: #055596;"><b>Emotion</b></span><br/><span class="text-muted" style="font-size: 17px;">Step {{emotion_step_no}} of {{total_steps}}</span></p>

							<div id="emotion_thought" class="col-11" style="display: none;">
							</div>


							<label class="pt-2"><p><span style="font-size: 2em;"><i class="fas fa-arrow-circle-right"></i>&nbsp; <b>On a scale from 1 to 10, how strongly do you believe in your thought?</b></span><br/><span class="text-muted fs-5-5" style="color: #144b5e; font-weight: 500;">1: Do not believe; 10: Strongly believe</span></p>
							</label>

                            <div class="col-12">

								<div class="button_radio">
									<input type="radio" id="beliefVal_1" name="beliefVal" value="1" />
									<label for="beliefVal_1">1</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefVal_2" name="beliefVal" value="2" />
									<label for="beliefVal_2">2</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefVal_3" name="beliefVal" value="3" />
									<label for="beliefVal_3">3</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefVal_4" name="beliefVal" value="4" />
									<label for="beliefVal_4">4</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefVal_5" name="beliefVal" value="5" />
									<label for="beliefVal_5">5</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefVal_6" name="beliefVal" value="6" />
									<label for="beliefVal_6">6</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefVal_7" name="beliefVal" value="7" />
									<label for="beliefVal_7">7</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefVal_8" name="beliefVal" value="8" />
									<label for="beliefVal_8">8</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefVal_9" name="beliefVal" value="9" />
									<label for="beliefVal_9">9</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefVal_10" name="beliefVal" value="10" />
									<label for="beliefVal_10">10</label>
								</div>
                            </div>

							<label class="mt-5"><p><span style="font-size: 2em;"><i class="fas fa-arrow-circle-right"></i>&nbsp; <b>What emotion does this thought make you feel?</b></span><br/><span class="text-muted fs-5-5" style="color: #144b5e; font-weight: 500;">e.g., scared, ashamed, stressed, discouraged</span></p>
							</label>

							<div class="col-lg-5 mx-lg-2">
								<input type="text" id="emotion" name="emotion" placeholder="Enter your emotion here" class="form-control">
							</div>


							<label class="mt-5"><p><span style="font-size: 2em;"><i class="fas fa-arrow-circle-right"></i>&nbsp; <b>On a scale from 1 to 10, how strong is this emotion?</b></span><br/><span class="text-muted fs-5-5" style="color: #144b5e; font-weight: 500;">1: Not strong; 10: Extremely strong</span></p>
							</label>

                            <div class="col-12 mb-4">

								<div class="button_radio">
									<input type="radio" id="emotionStrengthVal_1" name="emotionStrengthVal" value="1" />
									<label for="emotionStrengthVal_1">1</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthVal_2" name="emotionStrengthVal" value="2" />
									<label for="emotionStrengthVal_2">2</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthVal_3" name="emotionStrengthVal" value="3" />
									<label for="emotionStrengthVal_3">3</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthVal_4" name="emotionStrengthVal" value="4" />
									<label for="emotionStrengthVal_4">4</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthVal_5" name="emotionStrengthVal" value="5" />
									<label for="emotionStrengthVal_5">5</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthVal_6" name="emotionStrengthVal" value="6" />
									<label for="emotionStrengthVal_6">6</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthVal_7" name="emotionStrengthVal" value="7" />
									<label for="emotionStrengthVal_7">7</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthVal_8" name="emotionStrengthVal" value="8" />
									<label for="emotionStrengthVal_8">8</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthVal_9" name="emotionStrengthVal" value="9" />
									<label for="emotionStrengthVal_9">9</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthVal_10" name="emotionStrengthVal" value="10" />
									<label for="emotionStrengthVal_10">10</label>
								</div>
                            </div>


							<!-- <p class="mb-2" id="empty_emotion" style="display: none; font-size: 1.6em;"><mark style="background-color:#fff3e0;">Please type the situation in the textbox above.</mark></p> -->
                            
                        </div>
                     </div>




                    <div class="step">
                        <div class="row">

							<p class="mb-4"><span class="fs-3 mb-1" style="color: #055596;"><b>Situation</b></span><br/><span class="text-muted" style="font-size: 17px;">Step {{situation_step_no}} of {{total_steps}}</span></p>

                            <div class="col-12">
                                <label for="situation" class="py-2"><p><span style="font-size: 2em;"><i class="fas fa-arrow-circle-right"></i>&nbsp; <b>What's a recent situation that led to this negative thought?</b></span><br/><span class="text-muted fs-5-5" style="color: #144b5e; font-weight: 500;">For example, if your negative thought is "<i>No one cares about me</i>," the situation might be "<i>My friend never texted me back</i>."</span></p> &nbsp;
                                </label>
                                <div class="form-group mb-4">
                            <textarea  id="situation" name="situation" placeholder="Enter the situation here" rows=3 required></textarea>
                            </div>

                            <p class="mb-2" id="empty_situation" style="display: none; font-size: 1.6em;"><mark style="background-color:#fff3e0;">Please type the situation in the textbox above.</mark></p>

                            </div>
                
                            
                        </div>
                     </div>


                     <div class="step">
                        <!-- <div id="cognitive_distortion_loading" style="align-items: center;">
                            <img src="https://raw.githubusercontent.com/ash-shar/DISHELPER/master/Spin-1s-200px.svg" style="vertical-align:middle; margin-right: 10px; width: 45px;" class="img-responsive" /> <span style="vertical-align: middle; color: #144b5e;" class="fs-3">Loading...</span>
                         </div> -->

                        <div class="form-check ps-0 q-box mb-3" id="cognitive_distortions">
                        </div>

						<div class="mt-0 mb-3" id="cognitive_distortions_results">
                        </div>

                        <p class="mb-2" id="empty_cognitive_distortion" style="display: none; font-size: 1.6em;"><mark style="background-color:#fff3e0;">Please select a thinking trap.</p>

                     </div>
                     <div class="step">
                        <!-- <div id="rational_response_loading" style="display: none;" class="text-center">
                            <img src="https://raw.githubusercontent.com/ash-shar/DISHELPER/master/Spin-1s-200px.svg" style="vertical-align:middle; margin-right: 10px; width: 45px;" class="img-responsive" /> <span style="vertical-align: middle; color: #144b5e;" class="fs-3" id="loading_text">Working out helpful ways to reframe your thought</span>
                        </div> -->

                        <div class="form-check ps-0 q-box" id="rational_response">
                        </div>

						<div class="mt-0 mb-3" id="rational_response_results">
                        </div>

                        <p class="mt-3 mb-2" id="empty_reframe" style="display: none; font-size: 1.6em;"><mark style="background-color:#fff3e0;">Please write a reframe.</mark></p>
                     </div>

                     <div class="step">

						<div class="row">

							<p class="mb-4"><span class="fs-3 mb-1" style="color: #055596;"><b>Reframe Your Thinking</b></span><br/><span class="text-muted" style="font-size: 17px;">Step {{reframe_step_no}} of {{total_steps}}</span></p>

							<label for="rational_response_text" class="py-2 mb-1"><span style="font-size: 2em;"><i class="fas fa-arrow-circle-right"></i>&nbsp; <b>Continue editing the reframe</b></span><br/><span class="text-muted fs-5-5" style="color: #144b5e; font-weight: 500;">You can continue to edit the reframe by making it more <i>relatable</i> to your situation, by thinking about the <i>next steps and actions</i>, or by making it more <i>empathetic</i>.</span></p> &nbsp;
							</label>

							<div class="reframe-edit-div form-group mt-3">
								<div>
									<textarea class="mt-2" id="rational_response_text" name="rational_response_text" placeholder="Write your reframe here" rows=3 required></textarea>

									<div id="rational_response_text_footer">
										<button type="button" id="finish_reframing">Finish Reframing and Continue</button>
									</div>									
									
								  </div>
							</div>
							
							



                            <p class="mt-3 mb-2" id="empty_improved_reframe" style="display: none; font-size: 1.6em;"><mark style="background-color:#fff3e0;">Please write a reframe in the textbox above.</p>

							<p class="mt-3 mb-2" id="empty_improved_reframe_context" style="display: none; font-size: 1.6em;"><mark style="background-color:#fff3e0;">Please write a context in the textbox above.</p>

						</div>

                     </div>

                     <div class="step">
                        <div class="row">

							<p class="mb-4"><span class="fs-3 mb-1" style="color: #055596;"><b>Evaluate This Activity</b></span><br/><span class="text-muted" style="font-size: 17px;">Step {{evaluate_step_no}} of {{total_steps}}</span></p>


							<div class="row mb-3">
                                <div class="col-12">
                                <div class="card" id="save-content">
                                    <div class="card-header fs-5-5" id="save-content-header">
                                        <strong>Let's look back at what you came up with:</strong>
                                      </div>                                
                                      <div class="card-body">
                                        <div class="row">

											{% if 2 not in skip_step_li%}
                                            <p class="fs-5-5 my-1"><b>Negative Thought:</b> <i><span id="thought_final_evaluate"></span></i></p>
											{% endif %}

											{% if 3 not in skip_step_li %}
											<p class="fs-5-5 my-1"><b>Emotion:</b> <i><span id="emotion_final_evaluate"></span></i></p>
											{% endif %}

											{% if 4 not in skip_step_li%}
                                            <p class="fs-5-5 my-1"><b>Situation:</b> <i><span id="situation_final_evaluate"></span></i></p>
											{% endif %}

											{% if 5 not in skip_step_li%}
                                            <p class="fs-5-5 my-1"><b>Thinking Trap:</b> <i><span id="thinking_trap_final_evaluate"></span></i></p>
											{% endif %}

                                            <p class="fs-5-5 my-1"><b>Reframe:</b> <i><span id="rational_response_final_evaluate"></span></i></p>
                                        </div>
                                        
                                        </div>
                                  </div>

								  <div class="mt-2">
									<button id="editor-submit"><i class="fa fa-download" aria-hidden="true"></i>&nbsp;Download Thought Record</button>
								</div>

                                </div>
                            </div>

							
							{% if 3 not in skip_step_li %}

							{% if emotion_questions == 'first' %}

							<label class="pt-2"><p><span style="font-size: 2em;"><i class="fas fa-arrow-circle-right"></i>&nbsp; <b>After doing this activity, how strongly do you believe in your original thought?</b></span><br/><span class="text-muted fs-5-5" style="color: #144b5e; font-weight: 500;">1: Do not believe; 10: Strongly believe</span></p>
							</label>

                            <div class="col-12 mb-3">

								<div class="button_radio">
									<input type="radio" id="beliefValAfter1_1" name="beliefValAfter1" value="1" />
									<label for="beliefValAfter1_1">1</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefValAfter1_2" name="beliefValAfter1" value="2" />
									<label for="beliefValAfter1_2">2</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefValAfter1_3" name="beliefValAfter1" value="3" />
									<label for="beliefValAfter1_3">3</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefValAfter1_4" name="beliefValAfter1" value="4" />
									<label for="beliefValAfter1_4">4</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefValAfter1_5" name="beliefValAfter1" value="5" />
									<label for="beliefValAfter1_5">5</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefValAfter1_6" name="beliefValAfter1" value="6" />
									<label for="beliefValAfter1_6">6</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefValAfter1_7" name="beliefValAfter1" value="7" />
									<label for="beliefValAfter1_7">7</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefValAfter1_8" name="beliefValAfter1" value="8" />
									<label for="beliefValAfter1_8">8</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefValAfter1_9" name="beliefValAfter1" value="9" />
									<label for="beliefValAfter1_9">9</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="beliefValAfter1_10" name="beliefValAfter1" value="10" />
									<label for="beliefValAfter1_10">10</label>
								</div>
                            </div>

							<label class="pt-2"><p><span style="font-size: 2em;"><i class="fas fa-arrow-circle-right"></i>&nbsp; <b>After doing this activity, how strong is your emotion?</b></span><br/><span class="text-muted fs-5-5" style="color: #144b5e; font-weight: 500;">1: Not strong; 10: Extremely strong</span></p>
							</label>

							<div class="col-12 mb-4">

								<div class="button_radio">
									<input type="radio" id="emotionStrengthValAfter1_1" name="emotionStrengthValAfter1" value="1" />
									<label for="emotionStrengthValAfter1_1">1</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthValAfter1_2" name="emotionStrengthValAfter1" value="2" />
									<label for="emotionStrengthValAfter1_2">2</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthValAfter1_3" name="emotionStrengthValAfter1" value="3" />
									<label for="emotionStrengthValAfter1_3">3</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthValAfter1_4" name="emotionStrengthValAfter1" value="4" />
									<label for="emotionStrengthValAfter1_4">4</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthValAfter1_5" name="emotionStrengthValAfter1" value="5" />
									<label for="emotionStrengthValAfter1_5">5</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthValAfter1_6" name="emotionStrengthValAfter1" value="6" />
									<label for="emotionStrengthValAfter1_6">6</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthValAfter1_7" name="emotionStrengthValAfter1" value="7" />
									<label for="emotionStrengthValAfter1_7">7</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthValAfter1_8" name="emotionStrengthValAfter1" value="8" />
									<label for="emotionStrengthValAfter1_8">8</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthValAfter1_9" name="emotionStrengthValAfter1" value="9" />
									<label for="emotionStrengthValAfter1_9">9</label>
								</div>
								<div class="button_radio">
									<input type="radio" id="emotionStrengthValAfter1_10" name="emotionStrengthValAfter1" value="10" />
									<label for="emotionStrengthValAfter1_10">10</label>
								</div>
                            </div>

						{% endif %}

						{% endif %}


							<p class="py-2 mb-1"><span style="font-size: 2em;"><i class="fas fa-arrow-circle-right"></i>&nbsp;<b>How strongly do you agree or disagree with the following statements?</b></span>&nbsp;
							</p>

                              <p class="mb-2 mt-2"><span class="fs-5-5" style="color: #055596;"><strong>I believe in the reframe I came up with.</strong></span> &nbsp;
                              </p>
                              <div class="form-check form-check-inline mx-3 survey_options">
                                <input class="form-check-input" type="radio" name="believable" id="believable_5" value="2" required>                    
                                <label class="form-check-label" for="believable_5">
                                  Strongly Agree
                                </label>
                              </div>

                              <div class="form-check form-check-inline mx-3 survey_options">
                                <input class="form-check-input" type="radio" name="believable" id="believable_4" value="1" required>
                                
                                <label class="form-check-label" for="believable_4">
                                    Somewhat Agree
                                </label>
                                </div>

                                <div class="form-check form-check-inline mx-3 survey_options">
                                    <input class="form-check-input" type="radio" name="believable" id="believable_2" value="-1" required>
                                    
                                    <label class="form-check-label" for="believable_2">
                                      Somewhat Disagree
                                    </label>
                                  </div>


                              <div class="form-check form-check-inline mx-3 survey_options">
                                  <input class="form-check-input" type="radio" name="believable" id="believable_1" value="-2" required>
                                  
                                  <label class="form-check-label" for="believable_1">
                                    Strongly Disagree
                                  </label>
                                </div>



                                <p class="mb-2 mt-2"><span class="fs-5-5" style="color: #055596;"><strong>The reframe helped me deal with the thoughts I was struggling with.</strong></span> &nbsp;
                                </p>
                                <div class="form-check form-check-inline mx-3 survey_options">
                                    <input class="form-check-input" type="radio" name="helpfulness" id="helpfulness_5" value="2" required>                    
                                    <label class="form-check-label" for="helpfulness_5">
                                      Strongly Agree
                                    </label>
                                  </div>

                                  <div class="form-check form-check-inline mx-3 survey_options">
                                    <input class="form-check-input" type="radio" name="helpfulness" id="helpfulness_4" value="1" required>                    
                                    <label class="form-check-label" for="helpfulness_4">
                                      Somewhat Agree
                                    </label>
                                  </div>

                                  <div class="form-check form-check-inline mx-3 survey_options">
                                    <input class="form-check-input" type="radio" name="helpfulness" id="helpfulness_2" value="-1" required>
                                    
                                    <label class="form-check-label" for="helpfulness_2">
                                      Somewhat Disagree
                                    </label>
                                  </div>

                                <div class="form-check form-check-inline mx-3 survey_options">
                                    <input class="form-check-input" type="radio" name="helpfulness" id="helpfulness_1" value="-2" required>
                                    
                                    <label class="form-check-label" for="helpfulness_1">
                                        Strongly Disagree
                                    </label>
                                  </div>



								  <p class="mb-2 mt-2"><span class="fs-5-5" style="color: #055596;"><strong>I will remember this reframe the next time I experience this thought.</strong></span> &nbsp;
								  </p>
								  
								  <div class="form-check form-check-inline mx-3 survey_options">
									  <input class="form-check-input" type="radio" name="stickiness" id="stickiness_5" value="2" required>                    
									  <label class="form-check-label" for="stickiness_5">
										Strongly Agree
									  </label>
									</div>
									
									<div class="form-check form-check-inline mx-3 survey_options">
									  <input class="form-check-input" type="radio" name="stickiness" id="stickiness_4" value="1" required>                    
									  <label class="form-check-label" for="stickiness_4">
										Somewhat Agree
									  </label>
									</div>
									
									<div class="form-check form-check-inline mx-3 survey_options">
									  <input class="form-check-input" type="radio" name="stickiness" id="stickiness_2" value="-1" required>
									  
									  <label class="form-check-label" for="stickiness_2">
										Somewhat Disagree
									  </label>
									</div>
  
									<div class="form-check form-check-inline mx-3 survey_options">
									  <input class="form-check-input" type="radio" name="stickiness" id="stickiness_1" value="-2" required>
									  
									  <label class="form-check-label" for="stickiness_1">
										  Strongly Disagree
									  </label>
									</div>
                                  
                                  



                                  <p class="mb-2 mt-2"><span class="fs-5-5" style="color: #055596;"><strong>By doing this activity, I learned how I can deal with future negative thoughts.</strong></span> &nbsp;
                                  </p>
                                  <div class="form-check form-check-inline mx-3 survey_options">
                                    <input class="form-check-input" type="radio" name="learnability" id="learnability_5" value="2" required>                    
                                    <label class="form-check-label" for="learnability_5">
                                      Strongly Agree
                                    </label>
                                  </div>

                                  <div class="form-check form-check-inline mx-3 survey_options">
                                    <input class="form-check-input" type="radio" name="learnability" id="learnability_4" value="1" required>                    
                                    <label class="form-check-label" for="learnability_4">
                                      Somewhat Agree
                                    </label>
                                  </div>

                                  <div class="form-check form-check-inline mx-3 survey_options">
                                    <input class="form-check-input" type="radio" name="learnability" id="learnability_2" value="-1" required>
                                    
                                    <label class="form-check-label" for="learnability_2">
                                      Somewhat Disagree
                                    </label>
                                  </div>

                                  <div class="form-check form-check-inline mx-3 survey_options">
                                      <input class="form-check-input" type="radio" name="learnability" id="learnability_1" value="-2" required>
                                      
                                      <label class="form-check-label" for="learnability_1">
                                        Strongly Disagree
                                      </label>
                                    </div>


									{% if extra_q == 1 %}

									<p class="mb-2 mt-4"><span class="fs-5-5" style="color: #055596;"><strong>I'll recommend this tool to others.</strong></span> &nbsp;
									</p>
									<div class="form-check form-check-inline mx-3 survey_options">
									  <input class="form-check-input" type="radio" name="recommendation" id="recommendation_5" value="2" required>                    
									  <label class="form-check-label" for="recommendation_5">
										Strongly Agree
									  </label>
									</div>
  
									<div class="form-check form-check-inline mx-3 survey_options">
									  <input class="form-check-input" type="radio" name="recommendation" id="recommendation_4" value="1" required>                    
									  <label class="form-check-label" for="recommendation_4">
										Somewhat Agree
									  </label>
									</div>
  
									<div class="form-check form-check-inline mx-3 survey_options">
									  <input class="form-check-input" type="radio" name="recommendation" id="recommendation_2" value="-1" required>
									  
									  <label class="form-check-label" for="recommendation_2">
										Somewhat Disagree
									  </label>
									</div>
  
									<div class="form-check form-check-inline mx-3 survey_options">
										<input class="form-check-input" type="radio" name="recommendation" id="recommendation_1" value="-2" required>
										
										<label class="form-check-label" for="recommendation_1">
										  Strongly Disagree
										</label>
									  </div>

									  {% endif %}




									{% if 3 not in skip_step_li %}

									{% if emotion_questions == 'second' %}

									<label class="pt-2 mt-3"><p><span style="font-size: 2em;"><i class="fas fa-arrow-circle-right"></i>&nbsp; <b>After doing this activity, how strongly do you believe in your original thought?</b></span><br/><span class="text-muted fs-5-5" style="color: #144b5e; font-weight: 500;">1: Do not believe; 10: Strongly believe</span></p>
									</label>

									<div class="col-12 mb-3">

										<div class="button_radio">
											<input type="radio" id="beliefValAfter2_1" name="beliefValAfter2" value="1" />
											<label for="beliefValAfter2_1">1</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="beliefValAfter2_2" name="beliefValAfter2" value="2" />
											<label for="beliefValAfter2_2">2</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="beliefValAfter2_3" name="beliefValAfter2" value="3" />
											<label for="beliefValAfter2_3">3</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="beliefValAfter2_4" name="beliefValAfter2" value="4" />
											<label for="beliefValAfter2_4">4</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="beliefValAfter2_5" name="beliefValAfter2" value="5" />
											<label for="beliefValAfter2_5">5</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="beliefValAfter2_6" name="beliefValAfter2" value="6" />
											<label for="beliefValAfter2_6">6</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="beliefValAfter2_7" name="beliefValAfter2" value="7" />
											<label for="beliefValAfter2_7">7</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="beliefValAfter2_8" name="beliefValAfter2" value="8" />
											<label for="beliefValAfter2_8">8</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="beliefValAfter2_9" name="beliefValAfter2" value="9" />
											<label for="beliefValAfter2_9">9</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="beliefValAfter2_10" name="beliefValAfter2" value="10" />
											<label for="beliefValAfter2_10">10</label>
										</div>
									</div>

									<label class="pt-2 mt-2"><p><span style="font-size: 2em;"><i class="fas fa-arrow-circle-right"></i>&nbsp; <b>After doing this activity, how strong is your emotion?</b></span><br/><span class="text-muted fs-5-5" style="color: #144b5e; font-weight: 500;">1: Not strong; 10: Extremely strong</span></p>
									</label>

									<div class="col-12 mb-4">

										<div class="button_radio">
											<input type="radio" id="emotionStrengthValAfter2_1" name="emotionStrengthValAfter2" value="1" />
											<label for="emotionStrengthValAfter2_1">1</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="emotionStrengthValAfter2_2" name="emotionStrengthValAfter2" value="2" />
											<label for="emotionStrengthValAfter2_2">2</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="emotionStrengthValAfter2_3" name="emotionStrengthValAfter2" value="3" />
											<label for="emotionStrengthValAfter2_3">3</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="emotionStrengthValAfter2_4" name="emotionStrengthValAfter2" value="4" />
											<label for="emotionStrengthValAfter2_4">4</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="emotionStrengthValAfter2_5" name="emotionStrengthValAfter2" value="5" />
											<label for="emotionStrengthValAfter2_5">5</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="emotionStrengthValAfter2_6" name="emotionStrengthValAfter2" value="6" />
											<label for="emotionStrengthValAfter2_6">6</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="emotionStrengthValAfter2_7" name="emotionStrengthValAfter2" value="7" />
											<label for="emotionStrengthValAfter2_7">7</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="emotionStrengthValAfter2_8" name="emotionStrengthValAfter2" value="8" />
											<label for="emotionStrengthValAfter2_8">8</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="emotionStrengthValAfter2_9" name="emotionStrengthValAfter2" value="9" />
											<label for="emotionStrengthValAfter2_9">9</label>
										</div>
										<div class="button_radio">
											<input type="radio" id="emotionStrengthValAfter2_10" name="emotionStrengthValAfter2" value="10" />
											<label for="emotionStrengthValAfter2_10">10</label>
										</div>
									</div>

								{% endif %}

								{% endif %}
                                    
                                    
                                <p class="mt-3 mb-2" id="empty_outcome" style="display: none; font-size: 1.6em;"><mark style="background-color:#fff3e0;">Please respond to all of the questions above.</mark></p>


                              <!-- <p class="mb-2 mt-4"><span class="fs-5-5" style="color: #055596;"><strong>In what ways is the response helpful? Check all that apply</strong></span> &nbsp;
                              </p>
                              <div class="form-check form-check-inline mx-3 survey_options">
                                  <input class="form-check-input" type="checkbox" name="helpful_ways" id="helpful_ways_1" value="0" required>
                                  
                                  <label class="form-check-label" for="helpful_ways_1">
                                    The response provides a more positive perspective on the situation
                                  </label>
                                </div>
                                <div class="form-check form-check-inline mx-3 survey_options">
                                  <input class="form-check-input" type="checkbox" name="helpful_ways" id="helpful_ways_2" value="1" required>
                                  
                                  <label class="form-check-label" for="helpful_ways_2">
                                    The response provides a more rational perspective on the situation
                                  </label>
                                </div>
                                <div class="form-check form-check-inline mx-3 survey_options">
                                  <input class="form-check-input" type="checkbox" name="helpful_ways" id="helpful_ways_3" value="2" required>                    
                                  <label class="form-check-label" for="helpful_to_you_3">
                                    The response provides a more realistic perspective on the situation
                                  </label>
                                </div> -->


                            </div>

                            </div>

                    <div class="step">
                        <div class="row">

							<p class="mb-4"><span class="fs-3 mb-1" style="color: #055596;"><b>Optional Survey</b></span><br/><span class="text-muted" style="font-size: 17px;">Step {{evaluate_step_no}} of {{total_steps}}</span></p>


                            <!-- <p class="fs-3 mt-3 mb-3" style="color: #055596;"><b>Optional Survey</b></p> -->

                            <p class="fs-5-5 my-2"> Please take a moment to answer the following <b>optional</b> questions. Your answers are totally anonymous—we won't be able to identify you based on this information. Your answers help us provide better information and support for people like you.</p>


                            <div class="mt-4 row">
                                <label class="col-lg-5 col-form-label form-control-label fs-5-5">Age</label>
                                <div class="col-lg-7 form-group">
                                    <select id="age_range" class="form-control" name="age_range" size="0">
                                        <option value="">Select</option>
                                        <option value="less than 12">Less than 12</option>
										<option value="13-14">13-14</option>
										<option value="15-17">15-17</option>
                                        <option value="18-24">18-24</option>
                                        <option value="25-34">25-34</option>
                                        <option value="35-44">35-44</option>
                                        <option value="45-54">45-54</option>
                                        <option value="55-64">55-64</option>
                                        <option value="65+">65+</option>
                                    </select>
                                </div>
                            </div>



                        <div class="mt-3 row">
                                <label class="col-lg-5 col-form-label form-control-label fs-5-5">Gender</label>
                                <div class="col-lg-7 form-group">
                                    <select id="gender" class="form-control" name="gender" size="0">
                                        <option value="">Select</option>
                                        <option value="Female">Female</option>
                                        <option value="Male">Male</option>
                                        <option value="Non-binary">Non-binary</option>
                                    </select>
                                </div>
                            </div>
                        

                        <div class="mt-3 row">
                            <label class="col-lg-5 col-form-label form-control-label fs-5-5">Race/Ethnicity</label>
                            <div class="col-lg-7 form-group">
                                <select id="race" class="form-control" name="race" size="0" >
                                    <option value="">Select</option>
                                    <option value="American Indian or Alaska Native">American Indian or Alaska Native</option>
                                    <option value="Asian">Asian</option>
                                    <option value="Black or African American (Non-Hispanic)">Black or African American (Non-Hispanic)</option>
                                    <option value="Hispanic or Latino">Hispanic or Latino</option>
                                    <option value="Middle Eastern or North African">Middle Eastern or North African</option>
                                    <option value="Native Hawaiian or Other Pacific Islander">Native Hawaiian or Other Pacific Islander</option>
                                    <option value="White (Non-Hispanic)">White (Non-Hispanic)</option>
                                    <option value="More than one of the above">More than one of the above</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>


                        <!-- <div class="mt-3 row">
                            <label class="col-lg-5 col-form-label form-control-label fs-5-5">Household Income</label>
                            <div class="col-lg-7 form-group">
                                <select id="income" class="form-control" name="income" size="0" >
                                    <option value="">Select</option>
                                    <option value="Less than $20,000">Less than $20,000</option>
                                    <option value="$20,000 - $39,999">$20,000 - $39,999</option>
                                    <option value="$39,999 - $59,999">$39,999 - $59,999</option>
                                    <option value="$60,000 - $79,999">$60,000 - $79,999</option>
                                    <option value="$80,000 - $99,999">$80,000 - $99,999</option>
                                    <option value="$100,000 - $149,999">$100,000 - $149,999</option>
                                    <option value="$150,000+">$150,000+</option>
                                </select>
                            </div>
                        </div> -->

						<div class="mt-3 row">
                            <label class="col-lg-5 col-form-label form-control-label fs-5-5">Education</label>
                            <div class="col-lg-7 form-group">
                                <select id="education" class="form-control" name="education" size="0" >
                                    <option value="">Select</option>
                                    <option value="Secondary">Middle School</option>
                                    <option value="High School">High School</option>
                                    <option value="Undergraduate">Undergraduate</option>
                                    <option value="Graduate">Graduate</option>
                                    <option value="Doctorate">Doctorate</option>
                                </select>
                            </div>
                        </div>


                        <div class="mt-3 row">
                            <label class="col-lg-5 col-form-label form-control-label fs-5-5">Which of the following populations best describes you? (select all that apply)</label>
                            <div class="col-lg-7 form-group">
                                <select id="population" class="form-control multiselect" name="population" size="0" multiple>
                                    <option title="Veteran" value="Veteran or active-duty military">Veteran or active-duty military</option>
                                    <option title="Caregiver" value="Caregiver of someone living with emotional or physical illness">Caregiver of someone living with emotional or physical illness</option>
                                    <option title="LGBTQ+" value="LGBTQ+">LGBTQ+</option>
                                    <option title="Student" value="Student">Student</option>
                                    <option title="Trauma" value="Trauma survivor">Trauma survivor</option>
                                    <option title="Parent" value="New or expecting parent">New or expecting parent</option>
                                    <option title="Healthcare" value="Healthcare worker">Healthcare worker</option>
									<option title="None" value="None of the above">None of the above</option>
                                </select>

                            </div>
                        </div>


                        <div class="mt-3 row">
                            <label class="col-lg-5 col-form-label form-control-label fs-5-5">What are the main things contributing to your mental health problems right now? (select all that apply)
                            </label>
                            <div class="col-lg-7 form-group" id="problems_div">
                                <select class="form-control multiselect" id="problems" name="problems" multiple>
                                    <option title="Abuse" value="Abuse or violence">Abuse or violence</option>
                                    <option title="Relationship" value="Relationship problems (friends, family, or significant other)">Relationship problems (friends, family, or significant other)</option>
                                    <option title="Image" value="Body image or self-image">Body image or self-image</option>
                                    <option title="School/Work" value="School or work problems">School or work problems</option>
                                    <option title="Basic" value="Basic needs (no food or housing)">Basic needs (no food or housing)</option>
                                    <option title="Financial" value="Financial problems">Financial problems</option>
                                    <option title="Lonely" value="Loneliness or isolation">Loneliness or isolation</option>
                                    <option title="Grief" value="Grief or loss of someone or something">Grief or loss</option>
                                    <option title="Discrimination" value="Racism, homophobia, transphobia, or discrimination">Racism, homophobia, transphobia, or discrimination</option>
                                    <option value="Other">Other</option>
                                  </select>
                            </div>
                        </div>


                        <div class="mt-3 row">
                            <label class="col-lg-5 col-form-label form-control-label fs-5-5">Have you ever received treatment/support for a mental health problem?
                            </label>
                            <div class="col-lg-7 form-group">
                                <select class="form-control" id="treatment" name="treatment">
                                    <option value="">Select</option>
                                    <option value="No">No</option>
                                    <option value="Yes">Yes</option>
                                  </select>
                            </div>
                        </div>


						<div class="mt-3 row">
                            <label class="col-lg-5 col-form-label form-control-label fs-5-5">Prior to using this tool, have you ever practiced reframing your thoughts before (e.g., through a different activity)?
                            </label>
                            <div class="col-lg-7 form-group">
                                <select class="form-control" id="prior_experience" name="prior_experience">
                                    <option value="">Select</option>
                                    <option value="No">No</option>
                                    <option value="Yes">Yes</option>
                                  </select>
                            </div>
                        </div>


                        




                        </div>


                    </div>


                     <div class="step">
                        <div class="row mt-1">
                            <p class="fs-3 mb-4" style="color: #055596;"><b>Thank You For Doing This Activity!</b></p>

                            <p class="fs-5-5 mb-4 col-12"> You've now learned how to identify thinking traps and break free from them. The more you practice this skill, the easier will it be to apply it in your daily life.</p>


							<p class="fs-5-5 mb-4 col-12"> <b>We also offer an expanded version of this tool where you can reframe thoughts with the assistance of an artificial intelligence, that can be accessed through <a href="https://screening.mhanational.org/changing-thoughts-with-an-ai-assistant/">this link</a>. </b> </p>

							 <!-- Add feedback input box  -->

							 <div class="row mt-3">
                                <div class="col-12">
                                <div class="card">
                                    <div class="card-header fs-5-5">
                                        <strong>We would love to know your feedback. Did you like using this tool? What can we do to improve?</strong>
                                      </div>                                
                                      <div class="card-body" id = "feedback-card">
                                        <div class="row">
                                            <div class="form-group my-3">		
                                                <textarea id="feedback" name="feedback" placeholder="Enter your feedback here" rows=3 required></textarea>
                                            </div>

											<p class="mb-2" id="empty_feedback" style="display: none; font-size: 1.6em;"><mark style="background-color:#fff3e0;">Please type your feedback in the textbox above.</mark></p>

                                            <button id="feedback-btn" type="button">Submit Feedback</button> 

											
                                        </div>
                                        
                                        </div>
                                  </div>
                                </div>
                            </div>



                            <div class="row mt-5">
                                <div class="col-12">
                                <div class="card" id="save-content-final">
                                    <div class="card-header fs-5-5" id="save-content-final-header">
                                        <strong>Let's look back at what you came up with:</strong>
                                      </div>                                
                                      <div class="card-body">
                                        <div class="row">

											{% if 2 not in skip_step_li%}
                                            <p class="fs-5-5 my-1"><b>Negative Thought:</b> <i><span id="thought_final"></span></i></p>
											{% endif %}

											{% if 3 not in skip_step_li %}
											<p class="fs-5-5 my-1"><b>Emotion:</b> <i><span id="emotion_final"></span></i></p>
											{% endif %}

											{% if 4 not in skip_step_li%}
                                            <p class="fs-5-5 my-1"><b>Situation:</b> <i><span id="situation_final"></span></i></p>
											{% endif %}

											{% if 5 not in skip_step_li%}
                                            <p class="fs-5-5 my-1"><b>Thinking Trap:</b> <i><span id="thinking_trap_final"></span></i></p>
											{% endif %}

                                            <p class="fs-5-5 my-1"><b>Reframe:</b> <i><span id="rational_response_final"></span></i></p>
                                        </div>
                                        
                                        </div>
                                  </div>

								  <div class="mt-2">
									<button id="final-editor-submit"><i class="fa fa-download" aria-hidden="true"></i>&nbsp;Download Thought Record</button>
								</div>

                                </div>
                            </div>



                            <!-- <div class="row mt-5">
                                <div class="col-11">
                                <div class="card">
                                    <div class="card-header fs-5-5">
                                        <strong>Help us improve this activity! Sign up for a research study with your email address and you could get xx$</strong>
                                      </div>                                
                                      <div class="card-body">
                                        <div class="row">
                                            <div class="form-group my-3">		
                                                <input  id="sign_up_email" name="sign_up_email" type="email" class="form-control" placeholder="Enter your email address here"/>
                                            </div>

                                            <button id="sign-up-btn" type="button">Sign Up</button> 
                                        </div>
                                        
                                        </div>
                                  </div>
                                </div>
                            </div> -->

							<div class="row mt-5" id="try_again">
                                <p class="fs-5"><button type="button" id="try_again"><i class="fas fa-redo" aria-hidden="true"></i>&nbsp;&nbsp;Try this activity again with a new negative thought</button></p>
                            </div>


                            <div class="row my-4">
                                <div class="col-12">
                                <div class="card">
                                    <div class="card-header fs-5-5">
                                        <strong>More activities like this</strong>
                                      </div>                                
                                      <div class="card-body">
                                        <div class="row">
                                            <p class="my-3 fs-5-5"><a target="_blank" href="https://screening.mhanational.org/diy/overcoming-negative-thoughts/" class="ext_url"><span style="color: #055596;">Overcoming Negative Thoughts: another interactive activity for dealing with negative thoughts</span></a></p>

                                            <p class="my-3 fs-5-5"><a target="_blank" href="https://screening.mhanational.org/diy/" class="ext_url"><span style="color: #055596;">Worksheets, apps, and other mental health DIY tools</span></a></p>

                                            <p class="my-3 fs-5-5"><a target="_blank" href="https://screening.mhanational.org/mental-health-101/" class="ext_url"><span style="color: #055596;">Learn more about mental health</span></a></p>

                                            <p class="my-3 fs-5-5"><a target="_blank" href="https://screening.mhanational.org/content/thinking-traps-how-can-i-deal-with-negative-thoughts/" class="ext_url"><span style="color: #055596;">Learn more about thinking traps</span></a></p>
                                        </div>
                                        
                                        </div>
                                  </div>
                                </div>
                            </div>
                            



                            


                        </div>
                     </div>
                     
                  </div>
                  <div id="q-box__buttons">
                     <button id="prev-btn" type="button">Previous</button> 
                     <button id="next-btn" type="button">Next</button> 
                     <button id="submit-btn" type="submit">Submit</button>
                  </div>

                  <div class="row d-none" id="other_thoughts" style="padding: 0px 30px;">
                  <div class="col-12 mt-3">

                    <p class="my-4 fs-5-5">Or, choose one of these common thoughts to work on:</p>

                    <button type="button" class="btn btn-outline-dark mx-2 my-2 other_thoughts_btn">No one cares about me</button>
                    <button type="button" class="btn btn-outline-dark mx-2 my-2 other_thoughts_btn">I'm a failure</button>
                    <button type="button" class="btn btn-outline-dark mx-2 my-2 other_thoughts_btn">I'll never be able to do anything</button>
                    <button type="button" class="btn btn-outline-dark mx-2 my-2 other_thoughts_btn">I am scared something bad will happen to the people I love</button>
                    <button type="button" class="btn btn-outline-dark mx-2 my-2 other_thoughts_btn">I will go crazy if I don't control my racing thoughts</button>
                    <button type="button" class="btn btn-outline-dark mx-2 my-2 other_thoughts_btn">I'm worthless</button>

                </div>
                </div>

				<div class="row" id="start_over_div_mobile">
					<hr/>
					<p class="fs-5 mt-3"><button type="button" id="start_over_mobile"><i class="fas fa-redo" aria-hidden="true"></i>&nbsp;&nbsp;Start Over</button></p>
				</div>
		
               </form>
            </div>
            </div>

			
         </div>
         

        </div>
    </div>
 



   </body>
</html>